// ==UserScript==
// @name         偶像大师ShinyColors汉化
// @namespace    https://github.com/biuuu/ShinyColors
// @version      1.13.0
// @description  录剧情视频到公开的网站请先取得译者同意，提交翻译或问题请到 https://github.com/biuuu/ShinyColors
// @icon         https://shinycolors.enza.fun/icon_192x192.png
// @author       biuuu
// @match        https://shinycolors.enza.fun/*
// @run-at       document-start
// @grant        GM_xmlhttpRequest
// @grant        GM_registerMenuCommand
// @grant        GM_unregisterMenuCommand
// @connect      api.interpreter.caiyunai.com
// @connect      translate.google.cn
// @connect      fanyi.baidu.com
// @updateURL    https://www.shiny.fun/ShinyColors.user.js
// @supportURL   https://github.com/biuuu/ShinyColors/issues
// ==/UserScript==
!function(){"use strict";var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function t(e,t,r){return e(r={path:t,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&r.path)}},r.exports),r.exports}var r="object"==typeof e&&e&&e.Object===Object&&e,n="object"==typeof self&&self&&self.Object===Object&&self,o=r||n||Function("return this")(),s=o.Symbol,a=Object.prototype,i=a.hasOwnProperty,c=a.toString,l=s?s.toStringTag:void 0;var u=function(e){var t=i.call(e,l),r=e[l];try{e[l]=void 0;var n=!0}catch(e){}var o=c.call(e);return n&&(t?e[l]=r:delete e[l]),o},d=Object.prototype.toString;var p=function(e){return d.call(e)},f=s?s.toStringTag:void 0;var h=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":f&&f in Object(e)?u(e):p(e)},m=Array.isArray;var g=function(e){return null!=e&&"object"==typeof e};var v=function(e){return"string"==typeof e||!m(e)&&g(e)&&"[object String]"==h(e)};var y=function(e){return!0===e||!1===e||g(e)&&"[object Boolean]"==h(e)};var w=function(e,t){return function(r){return e(t(r))}},b=w(Object.getPrototypeOf,Object),E=Function.prototype,k=Object.prototype,_=E.toString,S=k.hasOwnProperty,x=_.call(Object);var I=function(e){if(!g(e)||"[object Object]"!=h(e))return!1;var t=b(e);if(null===t)return!0;var r=S.call(t,"constructor")&&t.constructor;return"function"==typeof r&&r instanceof r&&_.call(r)==x};let A=window.unsafeWindow||window;const C=Math.floor(640/A.devicePixelRatio),j=Math.floor(1136/A.devicePixelRatio),M=e=>{e--,(()=>{let e=A.outerHeight,t=A.outerWidth;const r=document.body.clientHeight,n=document.body.clientWidth,o=C-r,s=j-n;(o||s)&&(e+=o,t+=s,A.resizeTo(t,e))})(),e>0&&setTimeout(()=>M(e),1e3)},T={origin:"https://www.shiny.fun",ai_host:"https://ai.shiny.fun",hash:"",localHash:"",version:"1.13.0",story:"normal",timeout:30,font1:"yuanti",font2:"heiti",auto:"off",bgm:"off",transCover:"off",dev:!1},R=Object.assign({},T),P=["origin","ai_host","font1","font2","timeout","story","auto","bgm","dev","transCover"],O=P,D=()=>{const e={};O.forEach(t=>{T[t]!==R[t]&&(e[t]=T[t])}),localStorage.setItem("sczh:setting",JSON.stringify(e))},F=()=>{let e=location.hash;e=e.slice(1).replace(/\?tdsourcetag=s_pc(tim|qq)_aiomsg/,""),e.split(";").forEach(e=>{let t=e.split("="),r=decodeURIComponent(t[0].trim()),n=t[1]?decodeURIComponent(t[1].trim()):"";r&&O.includes(r)&&(T[r]=n||R[r],D())})},z={auto:{on:"关闭机翻",off:"开启机翻",id:0,callback:()=>{T.auto="off"!==T.auto?"off":"on"}},transCover:{on:"关闭双语翻译",off:"开启双语翻译",id:0,callback:()=>{T.transCover="off"!==T.transCover?"off":"on",location.reload()}},story:{normal:"开启剧情提取",edit:"关闭剧情提取",id:0,callback:()=>{if("normal"===T.story)T.story="edit";else{const e=document.getElementById("btn-close-sczh");e?e.click():T.story="normal"}}},bgm:{on:"关闭BGM后台播放",off:"开启BGM后台播放",id:0,callback:()=>{T.bgm="off"!==T.bgm?"off":"on"}},origin:{id:0,title:"修改数据源",callback:()=>{const e=prompt("请输入数据源URL，清空则使用默认数据源",T.origin);null!==e&&(T.origin=e.trim())}},dev:{id:0,titles:["打开开发模式","关闭开发模式"],callback:()=>{T.dev=!T.dev}},update:{id:0,title:"检查更新",callback:()=>{window.open(T.origin+"/ShinyColors.user.js")}},resize:{id:0,title:"调整窗口尺寸",callback:()=>M(10)}};let L=window.unsafeWindow||window;const $=e=>{const t=T[e],r=z[e];let n="";if(y(t)){let e=t?1:0;n=r.titles[e]}else n=r.title||r[t];const o=r.id;o&&GM_unregisterMenuCommand(o),r.id=GM_registerMenuCommand(n,()=>{(0,r.callback)(),D(),N()})},N=()=>{if(!GM_registerMenuCommand||!GM_unregisterMenuCommand)return;["update","bgm","story","origin","auto","transCover","dev","resize"].forEach(e=>{$(e)})};(()=>{const e=localStorage.getItem("sczh:setting");let t=JSON.parse(e);I(t)||(t={});const{origin:r}=t;/^https?:\/\//.test(r)&&(T.origin=r.trim()),O.forEach(e=>{let r=t[e];v(r)&&(r=r.trim()),(y(r)||r)&&(T[e]=r)})})(),F(),N(),L.addEventListener("hashchange",F);const B=e=>{if(!e)return"";return e.replace(/[\u0020]+$/g,"").replace(/^[\u0020]+/g,"")},U=(e,t=!1)=>{let r=B(e).replace(/(\\r)?\\n/g,"\n").replace(/\\r/g,"\n");return t?r:r.replace(/\n{2,}/g,"\n")},H=e=>e.replace(/\u200b/g," "),W=e=>B(e).replace(/\r/g,"\n").replace(/\n{2,}/g,"\n"),J=(...e)=>{T.dev&&console.info(...e)},q=(...e)=>{console.info(...e)},G=e=>v(e)?e.replace(/\r?\n/g,"\\n").replace(/\r/g,"\\n"):e,K=(e="0.0.0",t="0.0.0")=>{let r=!1;const n=e.split(".").map(e=>parseInt(e,10)),o=t.split(".").map(e=>parseInt(e,10));for(let e=0;e<n.length;e++){(n[e]||0)>(o[e]||0)&&(r=!0)}return r},V=(e,t)=>{if(!e||!e.length)return e;let r=e,n=!1,o=((e=2)=>{let t="";for(let r=0;r<e;r++)t+=String.fromCharCode(Math.floor(16*Math.random()+65520));return t})(3);Array.isArray(e)&&(r=e.join(o),n=!0);for(let[e,n]of t){if(!e||e.length<2)continue;const t=e.replace(/\./g,"\\.").replace(/\*/g,"\\*");r=r.replace(new RegExp(t,"g"),n)}return n?r.split(o):r},Q=()=>{const e=new Map;return t=>{if(t&&!/^0+$/.test(t)&&"select"!==t){if(e.has(t)){const r=e.get(t);return e.set(t,r+1),`${t}-${r}`}e.set(t,0)}return t}},Z=(e,t)=>{try{if(t)return sessionStorage.setItem(e,JSON.stringify(t)),!0;{let t=sessionStorage.getItem(e);return JSON.parse(t)}}catch(e){}};const Y=new Map,X=(e,t)=>{const{expMap:r,wordMaps:n,textMap:o}=t,s=W(e);let a=s;return s?null!=o&&o.has(s)?o.get(s):(a=((e,t,r=[])=>{if(Y.has(e))return Y.get(e);let n=e;for(let[e,o]of t)n=n.replace(e,(...e)=>{let t=o;for(let n=1;n<e.length-2;n++){let o=e[n],s=!1;r.forEach(e=>{e.has(o)&&(t=t.replace("$"+n,e.get(o)),s=!0)}),s||(/億$/.test(e[n])&&(e[n]=e[n].replace(/億$/,"亿")),t=t.replace("$"+n,e[n]))}return t}),e.lastIndex=0;return e!==n&&Y.set(e,n),n})(s,r,n),s!==a?a:e):e},ee=(e,t,r)=>{if(!e||!v(e[t]))return;const n=e[t];e[t]=X(n,r)};var te=function(){this.__data__=[],this.size=0};var re=function(e,t){return e===t||e!=e&&t!=t};var ne=function(e,t){for(var r=e.length;r--;)if(re(e[r][0],t))return r;return-1},oe=Array.prototype.splice;var se=function(e){var t=this.__data__,r=ne(t,e);return!(r<0)&&(r==t.length-1?t.pop():oe.call(t,r,1),--this.size,!0)};var ae=function(e){var t=this.__data__,r=ne(t,e);return r<0?void 0:t[r][1]};var ie=function(e){return ne(this.__data__,e)>-1};var ce=function(e,t){var r=this.__data__,n=ne(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this};function le(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}le.prototype.clear=te,le.prototype.delete=se,le.prototype.get=ae,le.prototype.has=ie,le.prototype.set=ce;var ue=le;var de=function(){this.__data__=new ue,this.size=0};var pe=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r};var fe=function(e){return this.__data__.get(e)};var he=function(e){return this.__data__.has(e)};var me=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)};var ge,ve=function(e){if(!me(e))return!1;var t=h(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t},ye=o["__core-js_shared__"],we=(ge=/[^.]+$/.exec(ye&&ye.keys&&ye.keys.IE_PROTO||""))?"Symbol(src)_1."+ge:"";var be=function(e){return!!we&&we in e},Ee=Function.prototype.toString;var ke=function(e){if(null!=e){try{return Ee.call(e)}catch(e){}try{return e+""}catch(e){}}return""},_e=/^\[object .+?Constructor\]$/,Se=Function.prototype,xe=Object.prototype,Ie=Se.toString,Ae=xe.hasOwnProperty,Ce=RegExp("^"+Ie.call(Ae).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var je=function(e){return!(!me(e)||be(e))&&(ve(e)?Ce:_e).test(ke(e))};var Me=function(e,t){return null==e?void 0:e[t]};var Te=function(e,t){var r=Me(e,t);return je(r)?r:void 0},Re=Te(o,"Map"),Pe=Te(Object,"create");var Oe=function(){this.__data__=Pe?Pe(null):{},this.size=0};var De=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},Fe=Object.prototype.hasOwnProperty;var ze=function(e){var t=this.__data__;if(Pe){var r=t[e];return"__lodash_hash_undefined__"===r?void 0:r}return Fe.call(t,e)?t[e]:void 0},Le=Object.prototype.hasOwnProperty;var $e=function(e){var t=this.__data__;return Pe?void 0!==t[e]:Le.call(t,e)};var Ne=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=Pe&&void 0===t?"__lodash_hash_undefined__":t,this};function Be(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Be.prototype.clear=Oe,Be.prototype.delete=De,Be.prototype.get=ze,Be.prototype.has=$e,Be.prototype.set=Ne;var Ue=Be;var He=function(){this.size=0,this.__data__={hash:new Ue,map:new(Re||ue),string:new Ue}};var We=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e};var Je=function(e,t){var r=e.__data__;return We(t)?r["string"==typeof t?"string":"hash"]:r.map};var qe=function(e){var t=Je(this,e).delete(e);return this.size-=t?1:0,t};var Ge=function(e){return Je(this,e).get(e)};var Ke=function(e){return Je(this,e).has(e)};var Ve=function(e,t){var r=Je(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this};function Qe(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Qe.prototype.clear=He,Qe.prototype.delete=qe,Qe.prototype.get=Ge,Qe.prototype.has=Ke,Qe.prototype.set=Ve;var Ze=Qe;var Ye=function(e,t){var r=this.__data__;if(r instanceof ue){var n=r.__data__;if(!Re||n.length<199)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new Ze(n)}return r.set(e,t),this.size=r.size,this};function Xe(e){var t=this.__data__=new ue(e);this.size=t.size}Xe.prototype.clear=de,Xe.prototype.delete=pe,Xe.prototype.get=fe,Xe.prototype.has=he,Xe.prototype.set=Ye;var et=Xe;var tt=function(e,t){for(var r=-1,n=null==e?0:e.length;++r<n&&!1!==t(e[r],r,e););return e},rt=function(){try{var e=Te(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();var nt=function(e,t,r){"__proto__"==t&&rt?rt(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r},ot=Object.prototype.hasOwnProperty;var st=function(e,t,r){var n=e[t];ot.call(e,t)&&re(n,r)&&(void 0!==r||t in e)||nt(e,t,r)};var at=function(e,t,r,n){var o=!r;r||(r={});for(var s=-1,a=t.length;++s<a;){var i=t[s],c=n?n(r[i],e[i],i,r,e):void 0;void 0===c&&(c=e[i]),o?nt(r,i,c):st(r,i,c)}return r};var it=function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n};var ct=function(e){return g(e)&&"[object Arguments]"==h(e)},lt=Object.prototype,ut=lt.hasOwnProperty,dt=lt.propertyIsEnumerable,pt=ct(function(){return arguments}())?ct:function(e){return g(e)&&ut.call(e,"callee")&&!dt.call(e,"callee")};var ft=function(){return!1},ht=t((function(e,t){var r=t&&!t.nodeType&&t,n=r&&e&&!e.nodeType&&e,s=n&&n.exports===r?o.Buffer:void 0,a=(s?s.isBuffer:void 0)||ft;e.exports=a})),mt=/^(?:0|[1-9]\d*)$/;var gt=function(e,t){var r=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==r||"symbol"!=r&&mt.test(e))&&e>-1&&e%1==0&&e<t};var vt=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991},yt={};yt["[object Float32Array]"]=yt["[object Float64Array]"]=yt["[object Int8Array]"]=yt["[object Int16Array]"]=yt["[object Int32Array]"]=yt["[object Uint8Array]"]=yt["[object Uint8ClampedArray]"]=yt["[object Uint16Array]"]=yt["[object Uint32Array]"]=!0,yt["[object Arguments]"]=yt["[object Array]"]=yt["[object ArrayBuffer]"]=yt["[object Boolean]"]=yt["[object DataView]"]=yt["[object Date]"]=yt["[object Error]"]=yt["[object Function]"]=yt["[object Map]"]=yt["[object Number]"]=yt["[object Object]"]=yt["[object RegExp]"]=yt["[object Set]"]=yt["[object String]"]=yt["[object WeakMap]"]=!1;var wt=function(e){return g(e)&&vt(e.length)&&!!yt[h(e)]};var bt=function(e){return function(t){return e(t)}},Et=t((function(e,t){var n=t&&!t.nodeType&&t,o=n&&e&&!e.nodeType&&e,s=o&&o.exports===n&&r.process,a=function(){try{var e=o&&o.require&&o.require("util").types;return e||s&&s.binding&&s.binding("util")}catch(e){}}();e.exports=a})),kt=Et&&Et.isTypedArray,_t=kt?bt(kt):wt,St=Object.prototype.hasOwnProperty;var xt=function(e,t){var r=m(e),n=!r&&pt(e),o=!r&&!n&&ht(e),s=!r&&!n&&!o&&_t(e),a=r||n||o||s,i=a?it(e.length,String):[],c=i.length;for(var l in e)!t&&!St.call(e,l)||a&&("length"==l||o&&("offset"==l||"parent"==l)||s&&("buffer"==l||"byteLength"==l||"byteOffset"==l)||gt(l,c))||i.push(l);return i},It=Object.prototype;var At=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||It)},Ct=w(Object.keys,Object),jt=Object.prototype.hasOwnProperty;var Mt=function(e){if(!At(e))return Ct(e);var t=[];for(var r in Object(e))jt.call(e,r)&&"constructor"!=r&&t.push(r);return t};var Tt=function(e){return null!=e&&vt(e.length)&&!ve(e)};var Rt=function(e){return Tt(e)?xt(e):Mt(e)};var Pt=function(e,t){return e&&at(t,Rt(t),e)};var Ot=function(e){var t=[];if(null!=e)for(var r in Object(e))t.push(r);return t},Dt=Object.prototype.hasOwnProperty;var Ft=function(e){if(!me(e))return Ot(e);var t=At(e),r=[];for(var n in e)("constructor"!=n||!t&&Dt.call(e,n))&&r.push(n);return r};var zt=function(e){return Tt(e)?xt(e,!0):Ft(e)};var Lt=function(e,t){return e&&at(t,zt(t),e)},$t=t((function(e,t){var r=t&&!t.nodeType&&t,n=r&&e&&!e.nodeType&&e,s=n&&n.exports===r?o.Buffer:void 0,a=s?s.allocUnsafe:void 0;e.exports=function(e,t){if(t)return e.slice();var r=e.length,n=a?a(r):new e.constructor(r);return e.copy(n),n}}));var Nt=function(e,t){var r=-1,n=e.length;for(t||(t=Array(n));++r<n;)t[r]=e[r];return t};var Bt=function(e,t){for(var r=-1,n=null==e?0:e.length,o=0,s=[];++r<n;){var a=e[r];t(a,r,e)&&(s[o++]=a)}return s};var Ut=function(){return[]},Ht=Object.prototype.propertyIsEnumerable,Wt=Object.getOwnPropertySymbols,Jt=Wt?function(e){return null==e?[]:(e=Object(e),Bt(Wt(e),(function(t){return Ht.call(e,t)})))}:Ut;var qt=function(e,t){return at(e,Jt(e),t)};var Gt=function(e,t){for(var r=-1,n=t.length,o=e.length;++r<n;)e[o+r]=t[r];return e},Kt=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)Gt(t,Jt(e)),e=b(e);return t}:Ut;var Vt=function(e,t){return at(e,Kt(e),t)};var Qt=function(e,t,r){var n=t(e);return m(e)?n:Gt(n,r(e))};var Zt=function(e){return Qt(e,Rt,Jt)};var Yt=function(e){return Qt(e,zt,Kt)},Xt=Te(o,"DataView"),er=Te(o,"Promise"),tr=Te(o,"Set"),rr=Te(o,"WeakMap"),nr=ke(Xt),or=ke(Re),sr=ke(er),ar=ke(tr),ir=ke(rr),cr=h;(Xt&&"[object DataView]"!=cr(new Xt(new ArrayBuffer(1)))||Re&&"[object Map]"!=cr(new Re)||er&&"[object Promise]"!=cr(er.resolve())||tr&&"[object Set]"!=cr(new tr)||rr&&"[object WeakMap]"!=cr(new rr))&&(cr=function(e){var t=h(e),r="[object Object]"==t?e.constructor:void 0,n=r?ke(r):"";if(n)switch(n){case nr:return"[object DataView]";case or:return"[object Map]";case sr:return"[object Promise]";case ar:return"[object Set]";case ir:return"[object WeakMap]"}return t});var lr=cr,ur=Object.prototype.hasOwnProperty;var dr=function(e){var t=e.length,r=new e.constructor(t);return t&&"string"==typeof e[0]&&ur.call(e,"index")&&(r.index=e.index,r.input=e.input),r},pr=o.Uint8Array;var fr=function(e){var t=new e.constructor(e.byteLength);return new pr(t).set(new pr(e)),t};var hr=function(e,t){var r=t?fr(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.byteLength)},mr=/\w*$/;var gr=function(e){var t=new e.constructor(e.source,mr.exec(e));return t.lastIndex=e.lastIndex,t},vr=s?s.prototype:void 0,yr=vr?vr.valueOf:void 0;var wr=function(e){return yr?Object(yr.call(e)):{}};var br=function(e,t){var r=t?fr(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)};var Er=function(e,t,r){var n=e.constructor;switch(t){case"[object ArrayBuffer]":return fr(e);case"[object Boolean]":case"[object Date]":return new n(+e);case"[object DataView]":return hr(e,r);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return br(e,r);case"[object Map]":return new n;case"[object Number]":case"[object String]":return new n(e);case"[object RegExp]":return gr(e);case"[object Set]":return new n;case"[object Symbol]":return wr(e)}},kr=Object.create,_r=function(){function e(){}return function(t){if(!me(t))return{};if(kr)return kr(t);e.prototype=t;var r=new e;return e.prototype=void 0,r}}();var Sr=function(e){return"function"!=typeof e.constructor||At(e)?{}:_r(b(e))};var xr=function(e){return g(e)&&"[object Map]"==lr(e)},Ir=Et&&Et.isMap,Ar=Ir?bt(Ir):xr;var Cr=function(e){return g(e)&&"[object Set]"==lr(e)},jr=Et&&Et.isSet,Mr=jr?bt(jr):Cr,Tr={};Tr["[object Arguments]"]=Tr["[object Array]"]=Tr["[object ArrayBuffer]"]=Tr["[object DataView]"]=Tr["[object Boolean]"]=Tr["[object Date]"]=Tr["[object Float32Array]"]=Tr["[object Float64Array]"]=Tr["[object Int8Array]"]=Tr["[object Int16Array]"]=Tr["[object Int32Array]"]=Tr["[object Map]"]=Tr["[object Number]"]=Tr["[object Object]"]=Tr["[object RegExp]"]=Tr["[object Set]"]=Tr["[object String]"]=Tr["[object Symbol]"]=Tr["[object Uint8Array]"]=Tr["[object Uint8ClampedArray]"]=Tr["[object Uint16Array]"]=Tr["[object Uint32Array]"]=!0,Tr["[object Error]"]=Tr["[object Function]"]=Tr["[object WeakMap]"]=!1;var Rr=function e(t,r,n,o,s,a){var i,c=1&r,l=2&r,u=4&r;if(n&&(i=s?n(t,o,s,a):n(t)),void 0!==i)return i;if(!me(t))return t;var d=m(t);if(d){if(i=dr(t),!c)return Nt(t,i)}else{var p=lr(t),f="[object Function]"==p||"[object GeneratorFunction]"==p;if(ht(t))return $t(t,c);if("[object Object]"==p||"[object Arguments]"==p||f&&!s){if(i=l||f?{}:Sr(t),!c)return l?Vt(t,Lt(i,t)):qt(t,Pt(i,t))}else{if(!Tr[p])return s?t:{};i=Er(t,p,c)}}a||(a=new et);var h=a.get(t);if(h)return h;a.set(t,i),Mr(t)?t.forEach((function(o){i.add(e(o,r,n,o,t,a))})):Ar(t)&&t.forEach((function(o,s){i.set(s,e(o,r,n,s,t,a))}));var g=d?void 0:(u?l?Yt:Zt:l?zt:Rt)(t);return tt(g||t,(function(o,s){g&&(o=t[s=o]),st(i,s,e(o,r,n,s,t,a))})),i};var Pr=function(e){return Rr(e,5)};const Or=(e,t,r,n)=>{if(T.dev){let o=n;n&&(o=Pr(n)),J(`%c${e}%c %c${r[0]}`,...(e=>[`background-color:${e};color:#fff;padding:0 0.3em`,"",`color:${e};text-decoration:underline`])(t),r[1]||"","\n=>",o)}},Dr=e=>{const t=e.replace(/{num}/g,"\\d+").replace(/{uuid}/g,"[a-f\\d]{8}-([a-f\\d]{4}-){3}[a-f\\d]{12}");return new RegExp(`^${t}$`)},Fr={get:new Map,post:new Map,patch:new Map,put:new Map},zr=(e,t,r)=>{if(!r.has(e)){const t=e.includes("{")||e.includes("("),n={handles:[],key:t?Dr(e):e,type:t?"regexp":"string"};r.set(e,n)}const n=r.get(e);Array.isArray(t)?n.handles=n.handles.concat(t):n.handles.push(t)},Lr=(e,t,r)=>{if(Array.isArray(e))for(let n of e)zr(n,t,r);else zr(e,t,r)},$r=e=>(t,r)=>{const n=Fr[e];if(r)Lr(t,r,n);else{const e=t;for(let[t,r]of e)Lr(t,r,n)}},Nr={get:$r("get"),post:$r("post"),patch:$r("patch"),put:$r("put")},Br={GET:"#009688",PATCH:"#8BC34A",POST:"#3F51B5",PUT:"#9C27B0"},Ur=(e,t,r,n)=>async(...r)=>{var o,s;return Or(e,Br[e],[t],null===(o=r[0])||void 0===o?void 0:o.body),await(async(e,t,r)=>{if(r)try{for(let[n,o]of r){let r=!1;if(("string"===o.type&&o.key===t||"regexp"===o.type&&o.key.test(t))&&(r=!0),r){const t=o.handles;for(let r of t)await r(e)}}}catch(e){J(e)}})(null===(s=r[0])||void 0===s?void 0:s.body,t,Fr[e.toLowerCase()]),n(...r)},Hr=Array.prototype.push;Array.prototype.push=function(...e){var t;if("object"==typeof e[0]&&null!==(t=e[0])&&void 0!==t&&t.method){const{path:t,method:r,options:n,resolve:o}=e[0];e[0].resolve=Ur(r.toUpperCase(),t,0,o)}return Hr.apply(this,e)};const{origin:Wr,version:Jr}=T,qr=async()=>{const e=Math.floor(Date.now()/1e3/60/60/6),t=await fetch(`${Wr}/manifest.json?t=${e}`);if(t.ok){const e=await t.json();return e.time=Date.now(),localStorage.setItem("sczh:manifest",JSON.stringify(e)),e}throw new Error(`${t.status} ${t.url}`)};let Gr={data:null};const Kr=new Promise((e,t)=>{(async()=>{let e;try{let t=localStorage.getItem("sczh:manifest");t&&(e=JSON.parse(t)),Date.now()-e.time>60*T.cacheTime*1e3&&(e=!1)}catch(e){}return e?K(Jr,e.version)?e=await qr():setTimeout(qr,5e3):e=await qr(),e})().then(t=>{Gr.data=t,T.newVersion=t.version,T.hashes=t.hashes,e(t)}).catch(t)}),Vr=async(e,t)=>{if(!t){const{hashes:r}=await Kr;t=r[e.replace(/^\/(data\/)?/,"")]}return await(async e=>new Promise((t,r)=>{let n=setTimeout(()=>{r(`加载${e}超时`)},1e3*T.timeout);const o=e.startsWith("https://")?e:`${Wr}${e}`;fetch(o).then(e=>{if(clearTimeout(n),!e.ok)return r(`${e.status} ${e.url}`),"";const t=e.headers.get("content-type");return null!=t&&t.includes("json")?e.json():e.text()}).then(t).catch(r)}))(`${e}${t?"?v="+t:""}`)};var Qr=t((function(e,t){e.exports=function e(){var t,r="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==r?r:{},n=!r.document&&!!r.postMessage,o=r.IS_PAPA_WORKER||!1,s={},a=0,i={};function c(e){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},function(e){var t=w(e);t.chunkSize=parseInt(t.chunkSize),e.step||e.chunk||(t.chunkSize=null),this._handle=new f(t),(this._handle.streamer=this)._config=t}.call(this,e),this.parseChunk=function(e,t){var n=parseInt(this._config.skipFirstNLines)||0;if(this.isFirstChunk&&0<n){let t=this._config.newline;t||(s=this._config.quoteChar||'"',t=this._handle.guessLineEndings(e,s)),e=[...e.split(t).slice(n)].join(t)}this.isFirstChunk&&E(this._config.beforeFirstChunk)&&void 0!==(s=this._config.beforeFirstChunk(e))&&(e=s),this.isFirstChunk=!1,this._halted=!1,n=this._partialLine+e;var s=(this._partialLine="",this._handle.parse(n,this._baseIndex,!this._finished));if(!this._handle.paused()&&!this._handle.aborted()){if(e=s.meta.cursor,this._finished||(this._partialLine=n.substring(e-this._baseIndex),this._baseIndex=e),s&&s.data&&(this._rowCount+=s.data.length),n=this._finished||this._config.preview&&this._rowCount>=this._config.preview,o)r.postMessage({results:s,workerId:i.WORKER_ID,finished:n});else if(E(this._config.chunk)&&!t){if(this._config.chunk(s,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);this._completeResults=s=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(s.data),this._completeResults.errors=this._completeResults.errors.concat(s.errors),this._completeResults.meta=s.meta),this._completed||!n||!E(this._config.complete)||s&&s.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),n||s&&s.meta.paused||this._nextChunk(),s}this._halted=!0},this._sendError=function(e){E(this._config.error)?this._config.error(e):o&&this._config.error&&r.postMessage({workerId:i.WORKER_ID,error:e,finished:!1})}}function l(e){var t;(e=e||{}).chunkSize||(e.chunkSize=i.RemoteChunkSize),c.call(this,e),this._nextChunk=n?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(e){this._input=e,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(t=new XMLHttpRequest,this._config.withCredentials&&(t.withCredentials=this._config.withCredentials),n||(t.onload=b(this._chunkLoaded,this),t.onerror=b(this._chunkError,this)),t.open(this._config.downloadRequestBody?"POST":"GET",this._input,!n),this._config.downloadRequestHeaders){var e,r=this._config.downloadRequestHeaders;for(e in r)t.setRequestHeader(e,r[e])}var o;this._config.chunkSize&&(o=this._start+this._config.chunkSize-1,t.setRequestHeader("Range","bytes="+this._start+"-"+o));try{t.send(this._config.downloadRequestBody)}catch(e){this._chunkError(e.message)}n&&0===t.status&&this._chunkError()}},this._chunkLoaded=function(){4===t.readyState&&(t.status<200||400<=t.status?this._chunkError():(this._start+=this._config.chunkSize||t.responseText.length,this._finished=!this._config.chunkSize||this._start>=(e=>null!==(e=e.getResponseHeader("Content-Range"))?parseInt(e.substring(e.lastIndexOf("/")+1)):-1)(t),this.parseChunk(t.responseText)))},this._chunkError=function(e){e=t.statusText||e,this._sendError(new Error(e))}}function u(e){(e=e||{}).chunkSize||(e.chunkSize=i.LocalChunkSize),c.call(this,e);var t,r,n="undefined"!=typeof FileReader;this.stream=function(e){this._input=e,r=e.slice||e.webkitSlice||e.mozSlice,n?((t=new FileReader).onload=b(this._chunkLoaded,this),t.onerror=b(this._chunkError,this)):t=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var e=this._input,o=(this._config.chunkSize&&(o=Math.min(this._start+this._config.chunkSize,this._input.size),e=r.call(e,this._start,o)),t.readAsText(e,this._config.encoding));n||this._chunkLoaded({target:{result:o}})},this._chunkLoaded=function(e){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(e.target.result)},this._chunkError=function(){this._sendError(t.error)}}function d(e){var t;c.call(this,e=e||{}),this.stream=function(e){return t=e,this._nextChunk()},this._nextChunk=function(){var e,r;if(!this._finished)return e=this._config.chunkSize,t=e?(r=t.substring(0,e),t.substring(e)):(r=t,""),this._finished=!t,this.parseChunk(r)}}function p(e){c.call(this,e=e||{});var t=[],r=!0,n=!1;this.pause=function(){c.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){c.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(e){this._input=e,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){n&&1===t.length&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),t.length?this.parseChunk(t.shift()):r=!0},this._streamData=b((function(e){try{t.push("string"==typeof e?e:e.toString(this._config.encoding)),r&&(r=!1,this._checkIsFinished(),this.parseChunk(t.shift()))}catch(e){this._streamError(e)}}),this),this._streamError=b((function(e){this._streamCleanUp(),this._sendError(e)}),this),this._streamEnd=b((function(){this._streamCleanUp(),n=!0,this._streamData("")}),this),this._streamCleanUp=b((function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)}),this)}function f(e){var t,r,n,o,s=Math.pow(2,53),a=-s,c=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,l=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,u=this,d=0,p=0,f=!1,g=!1,v=[],y={data:[],errors:[],meta:{}};function b(t){return"greedy"===e.skipEmptyLines?""===t.join("").trim():1===t.length&&0===t[0].length}function k(){if(y&&n&&(S("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+i.DefaultDelimiter+"'"),n=!1),e.skipEmptyLines&&(y.data=y.data.filter((function(e){return!b(e)}))),_()){if(y)if(Array.isArray(y.data[0])){for(var t=0;_()&&t<y.data.length;t++)y.data[t].forEach(r);y.data.splice(0,1)}else y.data.forEach(r);function r(t,r){E(e.transformHeader)&&(t=e.transformHeader(t,r)),v.push(t)}}function o(t,r){for(var n=e.header?{}:[],o=0;o<t.length;o++){var i=o,u=t[o];u=((t,r)=>(t=>(e.dynamicTypingFunction&&void 0===e.dynamicTyping[t]&&(e.dynamicTyping[t]=e.dynamicTypingFunction(t)),!0===(e.dynamicTyping[t]||e.dynamicTyping)))(t)?"true"===r||"TRUE"===r||"false"!==r&&"FALSE"!==r&&((e=>{if(c.test(e)&&(e=parseFloat(e),a<e&&e<s))return 1})(r)?parseFloat(r):l.test(r)?new Date(r):""===r?null:r):r)(i=e.header?o>=v.length?"__parsed_extra":v[o]:i,u=e.transform?e.transform(u,i):u),"__parsed_extra"===i?(n[i]=n[i]||[],n[i].push(u)):n[i]=u}return e.header&&(o>v.length?S("FieldMismatch","TooManyFields","Too many fields: expected "+v.length+" fields but parsed "+o,p+r):o<v.length&&S("FieldMismatch","TooFewFields","Too few fields: expected "+v.length+" fields but parsed "+o,p+r)),n}var u;y&&(e.header||e.dynamicTyping||e.transform)&&(u=1,!y.data.length||Array.isArray(y.data[0])?(y.data=y.data.map(o),u=y.data.length):y.data=o(y.data,0),e.header&&y.meta&&(y.meta.fields=v),p+=u)}function _(){return e.header&&0===v.length}function S(e,t,r,n){e={type:e,code:t,message:r},void 0!==n&&(e.row=n),y.errors.push(e)}E(e.step)&&(o=e.step,e.step=function(t){y=t,_()?k():(k(),0!==y.data.length&&(d+=t.data.length,e.preview&&d>e.preview?r.abort():(y.data=y.data[0],o(y,u))))}),this.parse=function(o,s,a){var c=e.quoteChar||'"';return e.newline||(e.newline=this.guessLineEndings(o,c)),n=!1,e.delimiter?E(e.delimiter)&&(e.delimiter=e.delimiter(o),y.meta.delimiter=e.delimiter):((c=((t,r,n,o,s)=>{var a,c,l,u;s=s||[",","\t","|",";",i.RECORD_SEP,i.UNIT_SEP];for(var d=0;d<s.length;d++){for(var p,f=s[d],h=0,g=0,v=0,y=(l=void 0,new m({comments:o,delimiter:f,newline:r,preview:10}).parse(t)),w=0;w<y.data.length;w++)n&&b(y.data[w])?v++:(g+=p=y.data[w].length,void 0===l?l=p:0<p&&(h+=Math.abs(p-l),l=p));0<y.data.length&&(g/=y.data.length-v),(void 0===c||h<=c)&&(void 0===u||u<g)&&1.99<g&&(c=h,a=f,u=g)}return{successful:!!(e.delimiter=a),bestDelimiter:a}})(o,e.newline,e.skipEmptyLines,e.comments,e.delimitersToGuess)).successful?e.delimiter=c.bestDelimiter:(n=!0,e.delimiter=i.DefaultDelimiter),y.meta.delimiter=e.delimiter),c=w(e),e.preview&&e.header&&c.preview++,t=o,r=new m(c),y=r.parse(t,s,a),k(),f?{meta:{paused:!0}}:y||{meta:{paused:!1}}},this.paused=function(){return f},this.pause=function(){f=!0,r.abort(),t=E(e.chunk)?"":t.substring(r.getCharIndex())},this.resume=function(){u.streamer._halted?(f=!1,u.streamer.parseChunk(t,!0)):setTimeout(u.resume,3)},this.aborted=function(){return g},this.abort=function(){g=!0,r.abort(),y.meta.aborted=!0,E(e.complete)&&e.complete(y),t=""},this.guessLineEndings=function(e,t){e=e.substring(0,1048576),t=new RegExp(h(t)+"([^]*?)"+h(t),"gm");var r=(e=e.replace(t,"")).split("\r");if(e=1<(t=e.split("\n")).length&&t[0].length<r[0].length,1===r.length||e)return"\n";for(var n=0,o=0;o<r.length;o++)"\n"===r[o][0]&&n++;return n>=r.length/2?"\r\n":"\r"}}function h(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function m(e){var t=(e=e||{}).delimiter,r=e.newline,n=e.comments,o=e.step,s=e.preview,a=e.fastMode,c=null,l=!1,u=null==e.quoteChar?'"':e.quoteChar,d=u;if(void 0!==e.escapeChar&&(d=e.escapeChar),("string"!=typeof t||-1<i.BAD_DELIMITERS.indexOf(t))&&(t=","),n===t)throw new Error("Comment character same as delimiter");!0===n?n="#":("string"!=typeof n||-1<i.BAD_DELIMITERS.indexOf(n))&&(n=!1),"\n"!==r&&"\r"!==r&&"\r\n"!==r&&(r="\n");var p=0,f=!1;this.parse=function(i,m,g){if("string"!=typeof i)throw new Error("Input must be a string");var v=i.length,y=t.length,w=r.length,b=n.length,k=E(o),_=[],S=[],x=[],I=p=0;if(!i)return L();if(a||!1!==a&&-1===i.indexOf(u)){for(var A=i.split(r),C=0;C<A.length;C++){if(x=A[C],p+=x.length,C!==A.length-1)p+=r.length;else if(g)return L();if(!n||x.substring(0,b)!==n){if(k){if(_=[],O(x.split(t)),$(),f)return L()}else O(x.split(t));if(s&&s<=C)return _=_.slice(0,s),L(!0)}}return L()}for(var j=i.indexOf(t,p),M=i.indexOf(r,p),T=new RegExp(h(d)+h(u),"g"),R=i.indexOf(u,p);;)if(i[p]===u)for(R=p,p++;;){if(-1===(R=i.indexOf(u,R+1)))return g||S.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:_.length,index:p}),F();if(R===v-1)return F(i.substring(p,R).replace(T,u));if(u===d&&i[R+1]===d)R++;else if(u===d||0===R||i[R-1]!==d){-1!==j&&j<R+1&&(j=i.indexOf(t,R+1));var P=D(-1===(M=-1!==M&&M<R+1?i.indexOf(r,R+1):M)?j:Math.min(j,M));if(i.substr(R+1+P,y)===t){x.push(i.substring(p,R).replace(T,u)),i[p=R+1+P+y]!==u&&(R=i.indexOf(u,p)),j=i.indexOf(t,p),M=i.indexOf(r,p);break}if(P=D(M),i.substring(R+1+P,R+1+P+w)===r){if(x.push(i.substring(p,R).replace(T,u)),z(R+1+P+w),j=i.indexOf(t,p),R=i.indexOf(u,p),k&&($(),f))return L();if(s&&_.length>=s)return L(!0);break}S.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:_.length,index:p}),R++}}else if(n&&0===x.length&&i.substring(p,p+b)===n){if(-1===M)return L();p=M+w,M=i.indexOf(r,p),j=i.indexOf(t,p)}else if(-1!==j&&(j<M||-1===M))x.push(i.substring(p,j)),p=j+y,j=i.indexOf(t,p);else{if(-1===M)break;if(x.push(i.substring(p,M)),z(M+w),k&&($(),f))return L();if(s&&_.length>=s)return L(!0)}return F();function O(e){_.push(e),I=p}function D(e){var t=0;return-1!==e&&(e=i.substring(R+1,e))&&""===e.trim()?e.length:t}function F(e){return g||(void 0===e&&(e=i.substring(p)),x.push(e),p=v,O(x),k&&$()),L()}function z(e){p=e,O(x),x=[],M=i.indexOf(r,p)}function L(n){if(e.header&&!m&&_.length&&!l){var o=_[0],s=Object.create(null),a=new Set(o);let t=!1;for(let r=0;r<o.length;r++){let n=o[r];if(s[n=E(e.transformHeader)?e.transformHeader(n,r):n]){let e,i=s[n];for(;e=n+"_"+i,i++,a.has(e););a.add(e),o[r]=e,s[n]++,t=!0,(c=null===c?{}:c)[e]=n}else s[n]=1,o[r]=n;a.add(n)}t&&console.warn("Duplicate headers found and renamed."),l=!0}return{data:_,errors:S,meta:{delimiter:t,linebreak:r,aborted:f,truncated:!!n,cursor:I+(m||0),renamedHeaders:c}}}function $(){o(L()),_=[],S=[]}},this.abort=function(){f=!0},this.getCharIndex=function(){return p}}function g(e){var t=e.data,r=s[t.workerId],n=!1;if(t.error)r.userError(t.error,t.file);else if(t.results&&t.results.data){var o={abort:function(){n=!0,v(t.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:y,resume:y};if(E(r.userStep)){for(var a=0;a<t.results.data.length&&(r.userStep({data:t.results.data[a],errors:t.results.errors,meta:t.results.meta},o),!n);a++);delete t.results}else E(r.userChunk)&&(r.userChunk(t.results,o,t.file),delete t.results)}t.finished&&!n&&v(t.workerId,t.results)}function v(e,t){var r=s[e];E(r.userComplete)&&r.userComplete(t),r.terminate(),delete s[e]}function y(){throw new Error("Not implemented.")}function w(e){if("object"!=typeof e||null===e)return e;var t,r=Array.isArray(e)?[]:{};for(t in e)r[t]=w(e[t]);return r}function b(e,t){return function(){e.apply(t,arguments)}}function E(e){return"function"==typeof e}return i.parse=function(t,n){var o=(n=n||{}).dynamicTyping||!1;if(E(o)&&(n.dynamicTypingFunction=o,o={}),n.dynamicTyping=o,n.transform=!!E(n.transform)&&n.transform,!n.worker||!i.WORKERS_SUPPORTED)return o=null,i.NODE_STREAM_INPUT,"string"==typeof t?(t=(e=>65279!==e.charCodeAt(0)?e:e.slice(1))(t),o=new(n.download?l:d)(n)):!0===t.readable&&E(t.read)&&E(t.on)?o=new p(n):(r.File&&t instanceof File||t instanceof Object)&&(o=new u(n)),o.stream(t);(o=(()=>{var t;return!!i.WORKERS_SUPPORTED&&(t=(()=>{var t=r.URL||r.webkitURL||null,n=e.toString();return i.BLOB_URL||(i.BLOB_URL=t.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",n,")();"],{type:"text/javascript"})))})(),(t=new r.Worker(t)).onmessage=g,t.id=a++,s[t.id]=t)})()).userStep=n.step,o.userChunk=n.chunk,o.userComplete=n.complete,o.userError=n.error,n.step=E(n.step),n.chunk=E(n.chunk),n.complete=E(n.complete),n.error=E(n.error),delete n.worker,o.postMessage({input:t,config:n,workerId:o.id})},i.unparse=function(e,t){var r=!1,n=!0,o=",",s="\r\n",a='"',c=a+a,l=!1,u=null,d=!1,p=((()=>{if("object"==typeof t){if("string"!=typeof t.delimiter||i.BAD_DELIMITERS.filter((function(e){return-1!==t.delimiter.indexOf(e)})).length||(o=t.delimiter),"boolean"!=typeof t.quotes&&"function"!=typeof t.quotes&&!Array.isArray(t.quotes)||(r=t.quotes),"boolean"!=typeof t.skipEmptyLines&&"string"!=typeof t.skipEmptyLines||(l=t.skipEmptyLines),"string"==typeof t.newline&&(s=t.newline),"string"==typeof t.quoteChar&&(a=t.quoteChar),"boolean"==typeof t.header&&(n=t.header),Array.isArray(t.columns)){if(0===t.columns.length)throw new Error("Option columns is empty");u=t.columns}void 0!==t.escapeChar&&(c=t.escapeChar+a),t.escapeFormulae instanceof RegExp?d=t.escapeFormulae:"boolean"==typeof t.escapeFormulae&&t.escapeFormulae&&(d=/^[=+\-@\t\r].*$/)}})(),new RegExp(h(a),"g"));if("string"==typeof e&&(e=JSON.parse(e)),Array.isArray(e)){if(!e.length||Array.isArray(e[0]))return f(null,e,l);if("object"==typeof e[0])return f(u||Object.keys(e[0]),e,l)}else if("object"==typeof e)return"string"==typeof e.data&&(e.data=JSON.parse(e.data)),Array.isArray(e.data)&&(e.fields||(e.fields=e.meta&&e.meta.fields||u),e.fields||(e.fields=Array.isArray(e.data[0])?e.fields:"object"==typeof e.data[0]?Object.keys(e.data[0]):[]),Array.isArray(e.data[0])||"object"==typeof e.data[0]||(e.data=[e.data])),f(e.fields||[],e.data||[],l);throw new Error("Unable to serialize unrecognized input");function f(e,t,r){var a="",i=("string"==typeof e&&(e=JSON.parse(e)),"string"==typeof t&&(t=JSON.parse(t)),Array.isArray(e)&&0<e.length),c=!Array.isArray(t[0]);if(i&&n){for(var l=0;l<e.length;l++)0<l&&(a+=o),a+=m(e[l],l);0<t.length&&(a+=s)}for(var u=0;u<t.length;u++){var d=(i?e:t[u]).length,p=!1,f=i?0===Object.keys(t[u]).length:0===t[u].length;if(r&&!i&&(p="greedy"===r?""===t[u].join("").trim():1===t[u].length&&0===t[u][0].length),"greedy"===r&&i){for(var h=[],g=0;g<d;g++){var v=c?e[g]:g;h.push(t[u][v])}p=""===h.join("").trim()}if(!p){for(var y=0;y<d;y++){0<y&&!f&&(a+=o);var w=i&&c?e[y]:y;a+=m(t[u][w],y)}u<t.length-1&&(!r||0<d&&!f)&&(a+=s)}}return a}function m(e,t){var n,s;return null==e?"":e.constructor===Date?JSON.stringify(e).slice(1,25):(s=!1,d&&"string"==typeof e&&d.test(e)&&(e="'"+e,s=!0),n=e.toString().replace(p,c),(s=s||!0===r||"function"==typeof r&&r(e,t)||Array.isArray(r)&&r[t]||((e,t)=>{for(var r=0;r<t.length;r++)if(-1<e.indexOf(t[r]))return!0;return!1})(n,i.BAD_DELIMITERS)||-1<n.indexOf(o)||" "===n.charAt(0)||" "===n.charAt(n.length-1))?a+n+a:n)}},i.RECORD_SEP=String.fromCharCode(30),i.UNIT_SEP=String.fromCharCode(31),i.BYTE_ORDER_MARK="\ufeff",i.BAD_DELIMITERS=["\r","\n",'"',i.BYTE_ORDER_MARK],i.WORKERS_SUPPORTED=!n&&!!r.Worker,i.NODE_STREAM_INPUT=1,i.LocalChunkSize=10485760,i.RemoteChunkSize=5242880,i.DefaultDelimiter=",",i.Parser=m,i.ParserHandle=f,i.NetworkStreamer=l,i.FileStreamer=u,i.StringStreamer=d,i.ReadableStreamStreamer=p,r.jQuery&&((t=r.jQuery).fn.parse=function(e){var n=e.config||{},o=[];return this.each((function(e){if("INPUT"!==t(this).prop("tagName").toUpperCase()||"file"!==t(this).attr("type").toLowerCase()||!r.FileReader||!this.files||0===this.files.length)return!0;for(var s=0;s<this.files.length;s++)o.push({file:this.files[s],inputElem:this,instanceConfig:t.extend({},n)})})),s(),this;function s(){if(0===o.length)E(e.complete)&&e.complete();else{var r,n,s,c=o[0];if(E(e.before)){var l=e.before(c.file,c.inputElem);if("object"==typeof l){if("abort"===l.action)return r=c.file,n=c.inputElem,s=l.reason,void(E(e.error)&&e.error({name:"AbortError"},r,n,s));if("skip"===l.action)return void a();"object"==typeof l.config&&(c.instanceConfig=t.extend(c.instanceConfig,l.config))}else if("skip"===l)return void a()}var u=c.instanceConfig.complete;c.instanceConfig.complete=function(e){E(u)&&u(e,c.file,c.inputElem),a()},i.parse(c.file,c.instanceConfig)}}function a(){o.splice(0,1),s()}}),o&&(r.onmessage=function(e){e=e.data,void 0===i.WORKER_ID&&e&&(i.WORKER_ID=e.workerId),"string"==typeof e.input?r.postMessage({workerId:i.WORKER_ID,results:i.parse(e.input,e.config),finished:!0}):(r.File&&e.input instanceof File||e.input instanceof Object)&&(e=i.parse(e.input,e.config))&&r.postMessage({workerId:i.WORKER_ID,results:e,finished:!0})}),(l.prototype=Object.create(c.prototype)).constructor=l,(u.prototype=Object.create(c.prototype)).constructor=u,(d.prototype=Object.create(d.prototype)).constructor=d,(p.prototype=Object.create(c.prototype)).constructor=p,i}()}));const Zr=e=>{try{return Qr.parse(e.replace(/^\ufeff/,""),{header:!0}).data}catch(e){return console.log(e),{}}},Yr=(e,t="EMPTY")=>e.sort((e,r)=>{let n=e,o=r;return"EMPTY"!==t&&(n=e[t],o=r[t]),o||(o=""),n||(n=""),o.length>n.length?1:n.length>o.length?-1:0});let Xr=null;const en=async e=>{if(!Xr)try{const e=localStorage.getItem("sczh:data");if(!e)return!1;Xr=JSON.parse(e)}catch(e){return console.error(e),!1}if(K(T.version,Xr.version))return Xr=null,localStorage.removeItem("sczh:data"),!1;let t=e;/(\.csv|\.json)/.test(e)||(t=e+".csv");const{hashes:r}=await Kr,n=r[t],o=Xr.hashes[t];return o&&o===n?Xr[e]:(Xr.hashes[t]=n,!1)},tn=(e,t)=>{Xr&&Xr.hashes||(Xr={hashes:T.hashes,version:T.version});let r=e;/(\.csv|\.json)/.test(e)||(r=e+".csv");const n=T.hashes[r];n&&(Xr.hashes[r]=n),Xr[e]=t;const o=JSON.stringify(Xr);try{localStorage.setItem("sczh:data",o)}catch(e){console.error(e)}},rn=new Map,nn=async(e,t)=>{const r=t||e;if(rn.has(e))return rn.get(e);let n=await en(e);n||(n=await Vr(`/data/${r}.csv`),tn(e,n));const o=Zr(n);return rn.set(e,o),o},on=e=>{const t=new Map;let r=!1;const{name:n,path:o,ignoreTrans:s}=e,a=e.keys||{},i=a.text||"text",c=a.trans||"trans";return async()=>{if(!r){const a=await nn(n,o);e.sort&&Yr(a,e.sort),a.forEach(e=>{const r=U(e[i]),n=H(U(e[c],!0));r&&(n||s)&&t.set(r,n)}),r=!0}return t}},sn=(e,t=[])=>{let r=e.replace(/\./g,"\\.").replace(/\$num/g,"([+-＋－]?[0-9０-９]{1,10}\\.?[0-9０-９]{0,4}[万億]?)").replace(/\$percent/g,"([+-＋－]?[0-9０-９]{1,10}\\.?[0-9０-９]{0,4}?[%％])").replace(/\$unknown/g,"([\\s\\S]*)").replace(/\$uk/g,"([\\s\\S]*)").replace(/\$sep/g,"[\\s\\S]?");return t.forEach(e=>{r=r.replace(e.re,e.exp),e.re.lastIndex=0}),new RegExp(r,"gi")},an=on({name:"name",keys:{text:"name"}}),cn=on({name:"etc/idol-name",keys:{text:"name"}});let ln=null;const un=async(e=!0)=>{if(ln)return ln;const t=await cn();ln=new Map;for(let[r,n]of t){const t=r.split(" "),o=n.split(" ");e&&ln.set(t[1],o[1]),ln.set(t.join(""),o.join("")),ln.set(r,n)}return ln};let dn=null;const pn=async()=>{if(dn)return dn;const e=await an(),t=await un();return dn=new Map([...e,...t]),dn},fn=(e,t)=>{let r=null;const n=((e,...t)=>{let r=null,n=null;return async()=>(n||(n=e(...t)),r||(r=await n),r)})((e=>{let t=!1,r=new Map,n=[],o=new Map;return async()=>{if(!t){const s=await nn(e),a=await un(),i=new Map,c=new Map,l=new Map,u=new Map([["name",[...a.keys()]]]),d=[];Yr(s,"text").forEach(e=>{if(null!=e&&e.text){const t=U(e.text),r=H(U(e.trans,!0)),n=B(e.type);t&&r&&(void 0===n||"text"===n?c.set(t,r):n&&"exp"!==n?(u.has(n)||u.set(n,[]),u.get(n).push((e=>e.replace(/\?/g,"\\?").replace(/\./g,"\\.").replace(/\*/g,"\\*").replace(/\+/g,"\\+").replace(/\(/g,"\\(").replace(/\)/g,"\\)"))(t)),i.set(t,r)):l.set(t.replace(/\[/g,"\\[").replace(/\]/g,"\\]"),r))}});for(let[e,t]of u)d.push({re:new RegExp("\\$"+e,"g"),exp:`(${t.join("|")})`});for(let[e,t]of l){const r=sn(e,d);o.set(r,t)}r=new Map([...c,...i,...a]),n=[i,a],t=!0}return{expMap:o,wordMaps:n,textMap:r}}})(e)),o=e=>async o=>(r||(r=await n(),t&&await t()),e&&e(o),r),s=e=>e.map(e=>{const t=e[1];return Array.isArray(t)?e[1]=t.map(e=>o(e)):e[1]=o(t),e}),a=(e,t)=>{const r=e.match(/(.+?)([＋+]+)$/);return r?X(r[1],t)+r[2]:X(e,t)};return{api:{get(e){Nr.get(s(e))},post(e){Nr.post(s(e))},put(e){Nr.put(s(e))},patch(e){Nr.patch(s(e))}},transItem:(e,t,n=r)=>{if(null!=e&&e[t]){let r=a(e[t],n);if(r!==e[t])return e[t]=r;r=((e,t)=>e.split("/").map(e=>a(e,t)).join("/"))(e[t],n),r!==e[t]&&(e[t]=r)}},getTransItem:e=>(t,n)=>{e(t,n,r)},ensureData:o()}},{api:hn,transItem:mn}=fn("skill"),gn=e=>{var t,r;e&&(null===(t=e.skillEffects)||void 0===t||t.forEach(e=>{mn(e,"effectName"),mn(e,"effectDescription")}),null===(r=e.rivalMemoryAppealEffects)||void 0===r||r.forEach(e=>{mn(e,"effectName"),mn(e,"effectDescription")}))},vn=(e,t=!1)=>{e&&(mn(e,"comment"),mn(e,"name"),t&&gn(e),e.linkSkill&&(mn(e.linkSkill,"comment"),mn(e.linkSkill,"name"),t&&gn(e.linkSkill)))},yn=e=>{e&&e.forEach(e=>{mn(e,"releaseConditions"),mn(e.passiveSkills,"comment"),mn(e.passiveSkills,"name"),vn(e.skill),vn(e.concertActiveSkill),e.activeSkills&&e.activeSkills.forEach(e=>{vn(e)})})},wn=e=>{e.forEach(e=>{vn(e)})},bn=(e,t=!1)=>{var r,n,o;let s=e.userProduceIdol;s&&(null===(r=s.activeSkills)||void 0===r||r.forEach(e=>{vn(e)}),null===(n=s.passiveSkills)||void 0===n||n.forEach(e=>{vn(e)}),null===(o=s.limitBreaks)||void 0===o||o.forEach(e=>{vn(e)}),t&&yn(s.skillPanels))},En=e=>{e.forEach(e=>{vn(e.skill,!0)})},kn=e=>{e&&e.forEach(e=>{var t,r,n;null===(t=e.userFesDeck)||void 0===t||t.userFesDeckMembers.forEach(e=>{e.userFesIdol.activeSkills.forEach(e=>{gn(e)})}),null===(r=e.userRaidDeck)||void 0===r||r.userRaidDeckMembers.forEach(e=>{e.userFesIdol.activeSkills.forEach(e=>{vn(e,!0)})}),null===(n=e.rival)||void 0===n||n.rivalSkills.forEach(e=>{gn(e)})})},_n=e=>{yn(e.idol.skillPanels),wn(e.idol.memoryAppeals),(e=>{e.forEach(e=>{vn(e)})})(e.idol.abilities)},Sn=e=>{var t,r,n;yn(e.supportIdol.skillPanels),null===(t=e.supportIdol)||void 0===t||null===(r=t.supportIdolActiveSkill)||void 0===r||null===(n=r.activeSkills)||void 0===n||n.forEach(e=>{mn(e,"comment"),mn(e,"name")})},xn=e=>{const t=e.userFesIdol;t.activeSkills.forEach(e=>{vn(e)}),vn(t.memoryAppeal),t.passiveSkills.forEach(e=>{mn(e,"comment"),mn(e,"name")})},In=xn,An=e=>{var t,r,n,o;e.userProduceSupportIdols.forEach(e=>{yn(e.skillPanels)}),bn(e,!0),null===(t=e.userProduceLimitedSkills)||void 0===t||t.forEach(e=>{vn(e.passiveSkills),vn(e.skill)}),yn(null===(r=e.userProduceIdol)||void 0===r||null===(n=r.userIdol)||void 0===n||null===(o=n.idol)||void 0===o?void 0:o.skillPanels)},Cn=e=>{var t;e.userFesIdol&&(e.userFesIdol.activeSkills.forEach(e=>{vn(e,!0)}),vn(e.userFesIdol.memoryAppeal,!0),null===(t=e.userFesIdol.passiveSkills)||void 0===t||t.forEach(e=>{mn(e,"comment"),mn(e,"name"),gn(e)}))},jn=e=>{var t,r,n;null===(t=e.userFesDeck)||void 0===t||t.userFesDeckMembers.forEach(Cn),null===(r=e.userFesEventDeck)||void 0===r||r.userFesEventDeckMembers.forEach(Cn),null===(n=e.userRaidDeck)||void 0===n||n.userRaidDeckMembers.forEach(Cn),En(e.judges),kn(e.userFesRivals),kn(e.userFesRaidRivals),gn(e.feverActiveSkill)},Mn=e=>{var t;null===(t=e.fanActiveSkills)||void 0===t||t.forEach(e=>{vn(e,!0)}),e.userProduceSupportIdols.forEach(e=>{vn(e.activeSkill,!0)});let r=e.userProduceIdol;r.activeSkills.forEach(e=>{vn(e,!0)}),vn(r.memoryAppeal,!0),r.passiveSkills.forEach(e=>{vn(e,!0)});let n=e.produceAudition||e.produceConcert;En(n.judges),(e=>{e.forEach(e=>{gn(e.rivalMemoryAppeal),e.rivalSkills.forEach(e=>{gn(e)})})})(n.rivals),gn(e.feverActiveSkill)},Tn=e=>{if(e.gameData)try{let t=JSON.parse(e.gameData);t.produceAudition||t.produceConcert?Mn(t):(t.userFesDeck||t.userRaidDeck)&&jn(t),e.gameData=JSON.stringify(t)}catch(e){log(e)}},Rn=e=>{e.userProduceIdol.activeSkills.forEach(e=>{vn(e)})},Pn=e=>{var t,r,n;null===(t=e.userProduceReporterEvent)||void 0===t||null===(r=t.produceReporterEventResult)||void 0===r||null===(n=r.produceReporterEventSkills)||void 0===n||n.forEach(e=>{mn(e,"name")})};hn.get([[["userSupportIdols/{num}","userSupportIdols/statusMax","produceTeachingSupportIdols/{num}"],[Sn]],["userProduce(Teaching)?SupportIdols/{num}",[e=>{var t,r,n,o;yn(e.skillPanels),null===(t=e.userSupportIdol)||void 0===t||null===(r=t.supportIdol)||void 0===r||null===(n=r.supportIdolActiveSkill)||void 0===n||null===(o=n.activeSkills)||void 0===o||o.forEach(e=>{mn(e,"comment"),mn(e,"name")})}]],["userReserveSupportIdols/userSupportIdol/{num}",[e=>{var t,r,n;yn(e.supportIdol.skillPanels),null===(t=e.supportIdol)||void 0===t||null===(r=t.supportIdolActiveSkill)||void 0===r||null===(n=r.activeSkills)||void 0===n||n.forEach(e=>{mn(e,"comment"),mn(e,"name")})}]],[["userIdols/{num}","userIdols/statusMax","produceTeachingIdols/{num}"],[_n]],[["userProduce(Teaching)?Idols/{num}","userProduceTeachingIdol"],e=>{e.activeSkills.forEach(e=>{vn(e)}),wn(e.userIdol.idol.memoryAppeals)}],["userReserveIdols/userIdol/{num}",e=>{yn(e.idol.skillPanels),wn(e.idol.memoryAppeals)}],["userFesIdols/{num}",xn],[["userProduces/skillPanels","userProduceTeachings/skillPanels"],An],["fes(Match)?Concert/actions/resume",[Tn]],["earthUsers/{uuid}/userFesIdols/{num}",In],["userRaidDecks",e=>{e.userRaidDecks.forEach(e=>{e.userRaidDeckMembers.forEach(e=>{var t;null===(t=e.userFesIdol)||void 0===t||t.activeSkills.forEach(e=>{vn(e)})})})}],["userProduceAbilities",Rn],["userProduces",[Pn]]]),hn.post([["userIdols/{num}/produceExSkills/{num}/actions/set",_n],[["userProduce(Teaching)?s/skillPanels/{num}","userProduces/limitedSkills/{num}"],An],["userSupportIdols/{num}/produceExSkills/{num}/actions/set",[Sn]],[["produces/actions/resume","produces/actions/finish","produceTeachings/resume"],[e=>{e.gameData||bn(e)},Tn]],[["produces/actions/resume","produces/actions/next"],[Pn]],["fes(Match|Raid|Tower)?Concert/actions/start",[jn]],["fes(Match)?Concert/actions/resume",[Tn]],["fes(Raid|Tower)Concert/actions/resume",[e=>{if(e.gameState&&e.gameState.game_data)try{let t=JSON.parse(e.gameState.game_data);(t.userRaidDeck||t.userFesEventDeck)&&jn(t),e.gameState.game_data=JSON.stringify(t)}catch(e){log(e)}}]],[["produce(Teaching)?s/({num}/audition|concert)/actions/start","produceTeachings/(auditions|concerts)/start"],[Mn]],["userProduceAbilities",Rn]]),hn.patch([["userFesDecks",e=>{e.userFesDecks.forEach(e=>{e.userFesDeckMembers.forEach(Cn)})}],["userSupportIdols/{num}",e=>{Sn(e.userSupportIdol)}]]);const{api:On,transItem:Dn}=fn("etc/ex-skill"),Fn=e=>{Dn(e,"name"),Dn(e,"description")},zn=e=>{e.userIdolProduceExSkills.forEach(e=>{Fn(e.produceExSkill)})},Ln=e=>{var t;null===(t=e.userSupportIdolProduceExSkills)||void 0===t||t.forEach(e=>{Fn(e.produceExSkill)})},$n=e=>{const t=e.userFesIdol;t.userFesIdolProduceExSkills.forEach(e=>{Fn(e.produceExSkill)}),t.userFesSupportIdols.forEach(e=>{e.userFesSupportIdolProduceExSkills.forEach(e=>{Fn(e.produceExSkill)})})},Nn=$n;On.get([[["userIdols/produceExSkillTop","userSupportIdols/produceExSkillTop","userIdols/{num}/produceExSkillTop","userSupportIdols/{num}/produceExSkillTop"],e=>{var t,r,n,o,s,a;null===(t=e.userIdols)||void 0===t||t.forEach(e=>{var t;null===(t=e.userIdolProduceExSkills)||void 0===t||t.forEach(e=>{Fn(e.produceExSkill)})}),null===(r=e.userSupportIdols)||void 0===r||r.forEach(e=>{var t;null===(t=e.userSupportIdolProduceExSkills)||void 0===t||t.forEach(e=>{Fn(e.produceExSkill)})}),null===(n=e.userIdol)||void 0===n||null===(o=n.userIdolProduceExSkills)||void 0===o||o.forEach(e=>{Fn(e.produceExSkill)}),null===(s=e.userSupportIdol)||void 0===s||null===(a=s.userSupportIdolProduceExSkills)||void 0===a||a.forEach(e=>{Fn(e.produceExSkill)}),e.userProduceExSkills.forEach(e=>{var t;Fn(e.produceExSkill),Fn(null===(t=e.produceExSkillUpgrade)||void 0===t?void 0:t.produceExSkill)})}],[["userSupportIdols/{num}","userSupportIdols/statusMax","produceTeachingSupportIdols/{num}"],[Ln]],["userProduce(Teaching)?SupportIdols/{num}",[e=>{var t;null===(t=e.userProduceSupportIdolProduceExSkills)||void 0===t||t.forEach(e=>{Fn(e.produceExSkill)})}]],[["userIdols/{num}","userIdols/statusMax","produceTeachingIdols/{num}"],[zn]],[["userProduce(Teaching)?Idols/{num}","userProduceTeachingIdol"],e=>{e.userProduceIdolProduceExSkills.forEach(e=>{Fn(e.produceExSkill)})}],["userFesIdols/{num}",$n],["earthUsers/{uuid}/userFesIdols/{num}",Nn],["userProducerSkills/summaries",e=>{e.forEach(e=>{Fn(e)})}]]),On.post([["userIdols/{num}/produceExSkills/{num}/actions/set",zn],["userSupportIdols/{num}/produceExSkills/{num}/actions/set",[Ln]],["produces/actions/result",[e=>{e.produceExSkillRewards.forEach(e=>{Fn(e.produceExSkill)})}]],["business/actions/finish",e=>{e.slots.forEach(e=>{e.businessProduceExSkillRewards.forEach(e=>{Fn(e.produceExSkill)})})}],["userProduceExSkills/actions/upgrade",e=>{Fn(e.produceExSkill)}]]);const{api:Bn,transItem:Un,ensureData:Hn}=fn("etc/idol-filter"),Wn=Hn;Bn.get([["searchPopupContents",e=>{var t,r,n,o;null===(t=e.businesses)||void 0===t||t.forEach(e=>{Un(e,"name")}),null===(r=e.units)||void 0===r||r.forEach(e=>{Un(e,"name")}),null===(n=e.produces)||void 0===n||n.forEach(e=>{Un(e,"title")}),null===(o=e.characters)||void 0===o||o.forEach(e=>{Un(e,"name"),Un(e,"firstName"),Un(e.unit,"name")}),(e=>{["activeSkills","ideas","idolArrivalTypes","knowHowBooks","supportSkillAttributes","supportSkillEffects"].forEach(t=>{var r;null===(r=e[t])||void 0===r||r.forEach(e=>{Un(e,"label")})})})(e)}]]);const{api:Jn,transItem:qn}=fn("support-skill",Wn),Gn=e=>{null==e||e.forEach(e=>{qn(e,"description"),(e=>{const t=e.name;if(t.includes("マスタリー")&&!t.endsWith("マスタリー")){const r=t.replace(/.+マスタリー/,""),n={keyword:t.replace(r,"")};Un(n,"keyword"),e.name=n.keyword+r}else Un(e,"name")})(e)})},Kn=e=>{var t,r;const n=null!==(t=e.userSupportIdol)&&void 0!==t?t:e;Gn(n.acquiredSupportSkills),Gn(n.supportSkills),Gn(null===(r=n.supportIdol)||void 0===r?void 0:r.supportSkills)},Vn=e=>{qn(e,"name"),qn(e,"comment"),null!=e&&e.comment&&(e.comment=e.comment.replace(/\((\d+),(\d+),(\d+)\)/,"($1/$2/$3)"))},Qn=e=>{var t,r;const n=null!==(t=e.userSupportIdol)&&void 0!==t?t:e,o=null==n||null===(r=n.supportIdol)||void 0===r?void 0:r.fightSkill;o&&(Vn(o),o.skills.forEach(e=>{Vn(e.skill),gn(e.skill.skillEffects)}))};Jn.get([[["userSupportIdols/{num}","userSupportIdols/statusMax","produceTeachingSupportIdols/{num}"],[Kn,Qn]],["userProduce(Teaching)?SupportIdols/{num}",[Kn,Qn]],["userReserveSupportIdols/userSupportIdol/{num}",[Kn,Qn]],["produces/{num}/decks",e=>{var t;null===(t=e.userSupportIdols)||void 0===t||t.forEach(e=>{var t;Gn(null===(t=e.supportIdol)||void 0===t?void 0:t.supportSkills)})}]]),Jn.post([["produces/{num}/actions/ready",[e=>{e.userDecks.forEach(e=>{e.userSupportIdols.forEach(e=>{var t;Gn(null===(t=e.supportIdol)||void 0===t?void 0:t.supportSkills)})})}]],["userSupportIdols/{num}/produceExSkills/{num}/actions/set",[Kn,Qn]],["produces/actions/(resume|next)",[Kn,Qn]],[["produceTeachings/resume","produceTeachings/next"],Kn]]),Jn.patch([["userSupportIdols/{num}",Kn],["produces/{num}/produceItem/consume",e=>{Gn(e.supportSkills)}]]);const{api:Zn,transItem:Yn}=fn("etc/idea-note"),Xn=e=>{var t;e&&(Yn(e,"title"),(e=>{Yn(e,"title"),Yn(e,"comment")})(e.produceIdeaNoteCompleteBonus),null===(t=e.produceIdeaNoteExtraBonuses)||void 0===t||t.forEach(e=>{Yn(e,"comment"),Yn(e,"condition")}))},eo=e=>{var t,r;null===(t=e.ideaNoteResult)||void 0===t||null===(r=t.seasonClearBonusIdeaNotes)||void 0===r||r.forEach(e=>{Xn(e)})};Zn.get([["userProduceIdeaNotes",e=>{e.forEach(e=>{Xn(e.produceIdeaNote)})}]]),Zn.post([["produces/actions/(resume|next)",[e=>{var t;null===(t=e.userProduceIdeaNotes)||void 0===t||t.forEach(e=>{Xn(e.produceIdeaNote)})},eo]],["produces/actions/act",[e=>{var t,r,n;null===(t=e.produceEvents)||void 0===t||t.forEach(e=>{var t;null===(t=e.produceIdeaNotes)||void 0===t||t.forEach(e=>{Xn(e)})});let o=null===(r=e.lessonResult)||void 0===r||null===(n=r.userProduceIdeaNote)||void 0===n?void 0:n.produceIdeaNote;Xn(o)}]],["produces/actions/endWeek",eo]]),Zn.patch([["userProduceIdeaNotes/228681479/actions/select",e=>{Xn(e.userProduceIdeaNote.produceIdeaNote)}]]);const{api:to,transItem:ro}=fn("etc/grad-skill"),no=e=>{var t;e&&(ro(e,"comment"),ro(e,"name"),ro(e,"acquireComment"),ro(e,"releaseComment"),null===(t=e.produceAbilityAcquireConditionComments)||void 0===t||t.forEach(e=>{ro(e,"name")}))},oo=e=>{e.userFesIdol.abilities.forEach(e=>{no(e)})},so=oo,ao=e=>{var t,r,n;const o=e=>{e.userFesIdol.abilities.forEach(e=>{no(e)}),e.userFesIdol.concertAbilities.forEach(e=>{no(e)})};null===(t=e.userFesDeck)||void 0===t||t.userFesDeckMembers.forEach(o),null===(r=e.userFesEventDeck)||void 0===r||r.userFesEventDeckMembers.forEach(o),null===(n=e.userRaidDeck)||void 0===n||n.userRaidDeckMembers.forEach(o)},io=e=>{var t,r;const n=e.userProduceIdol;n&&(null===(t=n.abilities)||void 0===t||t.forEach(e=>{no(e)}),null===(r=n.concertAbilities)||void 0===r||r.forEach(e=>{no(e)}))},co=e=>{if(e.gameData)try{let t=JSON.parse(e.gameData);t.produceAudition||t.produceConcert?io(t):(t.userFesDeck||t.userRaidDeck)&&ao(t),e.gameData=JSON.stringify(t)}catch(e){log(e)}},lo=e=>{e.userProduceIdol.abilities.forEach(e=>{no(e)}),e.userProduceAbilities.forEach(e=>{no(e.ability)})};to.get([["userFesIdols/{num}",oo],["fes(Match)?Concert/actions/resume",[co]],["earthUsers/{uuid}/userFesIdols/{num}",so],["userProduceAbilities",lo],[["userProduceAreas"],e=>{var t;null===(t=e.abilities)||void 0===t||t.forEach(e=>{no(e)})}]]),to.post([[["produces/actions/resume","produces/actions/finish","produceTeachings/resume"],[e=>{e.gameData||((e,t=!1)=>{var r;let n=e.userProduceIdol;n&&(null===(r=n.abilities)||void 0===r||r.forEach(e=>{no(e)}))})(e)},co]],["fes(Match|Raid)?Concert/actions/start",[ao]],["fes(Match)?Concert/actions/resume",[co]],["fes(Raid|Tower)Concert/actions/resume",[e=>{if(e.gameState&&e.gameState.game_data)try{let t=JSON.parse(e.gameState.game_data);(t.userRaidDeck||t.userFesEventDeck)&&ao(t),e.gameState.game_data=JSON.stringify(t)}catch(e){log(e)}}]],[["produce(Teaching)?s/({num}/audition|concert)/actions/start","produceTeachings/(auditions|concerts)/start"],[io]],["produces/({num}/audition|concert)/actions/(start|finish)",e=>{var t,r;null===(t=e.concertEvent)||void 0===t||null===(r=t.abilities)||void 0===r||r.forEach(e=>{ro(e,"name")})}],["userProduceAbilities",lo]]);const{api:uo,transItem:po}=fn("etc/landing-point"),fo=e=>{e&&(po(e,"comment"),po(e,"name"),po(e,"acquireComment"),po(e,"releaseComment"))},ho=e=>{po(e,"title"),e.produceMusicAssignmentClearBonuses.forEach(e=>{po(e,"title")})},mo=e=>{var t,r;po(e.feverActiveSkill,"comment"),e.produceMusicProficiencyBonuses.forEach(e=>{var t;po(e,"description"),e.ability&&(fo(e.ability),null===(t=e.ability.produceAbilityAcquireConditionComments)||void 0===t||t.forEach(e=>{po(e,"name")}))}),null===(t=e.produceMusicAssignments)||void 0===t||t.forEach(ho),null===(r=e.produceMusicProficiencyJudgeStarBonuses)||void 0===r||r.forEach(e=>{po(e,"description")})},go=e=>{var t,r,n;mo(e.produceMusic),null===(t=e.userProduceMusicAssignments)||void 0===t||t.forEach(e=>{ho(e.produceMusicAssignment)}),null===(r=e.allUserProduceMusicAssignments)||void 0===r||r.forEach(e=>{ho(e.produceMusicAssignment)}),null===(n=e.judgeStarBonuses)||void 0===n||n.forEach(e=>{po(e,"description")})},vo=e=>{var t,r;null===(t=e.userProduceMusicProficiencies)||void 0===t||t.forEach(go),null===(r=e.activatedProduceMusicAssignmentBonuses)||void 0===r||r.forEach(e=>{var t;null===(t=e.produceMusicAssignmentClearBonuses)||void 0===t||t.forEach(e=>{po(e,"title")})})},yo=e=>{var t;fo(e),null===(t=e.skillEffects)||void 0===t||t.forEach(e=>{po(e,"effectDescription"),po(e,"effectName")})},wo=e=>{var t,r,n,o;null===(t=e.produceMusic)||void 0===t||null===(r=t.judgeStarBonuses)||void 0===r||r.forEach(e=>{po(e,"description")}),null===(n=e.userProduceIdol)||void 0===n||null===(o=n.abilities)||void 0===o||o.forEach(yo),po(e.feverActiveSkill,"comment")};uo.get([[["userProduceAreas","produceMusics"],e=>{var t;null===(t=e.produceMusics)||void 0===t||t.forEach(mo)}],["userProduces",[vo]],["userFesIdols/{num}",e=>{var t,r;null===(t=e.userFesIdol)||void 0===t||null===(r=t.abilities)||void 0===r||r.forEach(yo)}]]),uo.post([[["produces/actions/resume","produces/actions/next"],[vo]],["produces/actions/resume",e=>{if(e.gameData)try{let t=JSON.parse(e.gameData);t.produceAudition||t.produceConcert?wo(t):t.userFesDeck||t.userRaidDeck,e.gameData=JSON.stringify(t)}catch(e){log(e)}}],["userProduceMusicProficiencies",e=>{go(e.userProduceMusicProficiency)}],["produces/concert/actions/start",wo]]),uo.patch([["userProduceMusicAssignments/{num}",e=>{ho(e.produceMusicAssignment)}]]);const{api:bo,getTransItem:Eo,ensureData:ko}=fn("item"),_o=Eo((e,t,r)=>{if(null!=e&&e[t]){let n=e[t].split("\n");n.forEach((e,t)=>{ee(n,t,r)});let o=n.join("\n");o!==e[t]&&(e[t]=o)}}),So=Eo(ee),xo=Eo((e,t,r)=>{if(null!=e&&e[t]){let n=e[t];if(ee(e,t,r),e[t]===n){e[t]=e[t].replace("\n","");let o=e[t];ee(e,t,r),o===e[t]&&(e[t]=n)}}}),Io=["produceItem","recoveryItem","exchangeItem","lotteryTicket","evolutionItem","gashaTicket","scoutTicket","enhancementItem"],Ao=e=>{var t;null==e||null===(t=e.shopMerchandises)||void 0===t||t.forEach(e=>{var t;So(e,"title"),xo(e,"shopTitle"),_o(e,"comment"),null===(t=e.shopContents)||void 0===t||t.forEach(e=>{So(e.content,"name"),_o(e.content,"comment")})})},Co=e=>{let t=e;e.userProduceItems&&(t=e.userProduceItems),Array.isArray(t)&&t.forEach(e=>{const t=e[Io[0]]||e[Io[1]]||e[Io[2]]||e[Io[3]]||e[Io[4]]||e[Io[5]]||e[Io[6]]||e[Io[7]];So(t,"name"),_o(t,"comment")})},jo=e=>{e.accumulatedPresent.userGameEventAccumulatedPresents.forEach(e=>{e.gameEventAccumulatedPresent.rewards.forEach(e=>{So(e.content,"name")})})},Mo=e=>{var t;null==e||null===(t=e.activeProduceItems)||void 0===t||t.forEach(e=>{So(e.produceItem,"name"),_o(e.produceItem,"comment")})};bo.get([[["userShops","userIdolPieceShops"],e=>{e&&(Array.isArray(e.userShops)&&e.userShops.forEach(e=>{Ao(e)}),Array.isArray(e.userEventShops)&&e.userEventShops.forEach(e=>{Ao(e.userShop)}))}],[["userRecoveryItems","userProduceItems","userExchangeItems","userLotteryTickets","userEvolutionItems","userGashaTickets","userScoutTickets","userEnhancementItems"],Co],[["userPresents\\?limit={num}","userPresentHistories\\?limit={num}"],e=>{Array.isArray(e)&&e.forEach(e=>{So(e.content,"name"),So(e,"note")})}],["userProduces",Mo],["missionEvents/{num}/top",jo],["gashaGroups",e=>{var t;null===(t=e.gashaGroups)||void 0===t||t.forEach(e=>{var t;const r=null===(t=e.userGashaTicket)||void 0===t?void 0:t.gashaTicket;So(r,"name"),_o(r,"comment")})}],["businessTop",e=>{var t;null===(t=e.userRecoveryItems)||void 0===t||t.forEach(e=>{So(e.recoveryItem,"name")})}]]),bo.post([["myPage",e=>{Mo(e.userProduce)}],["(produceMarathons|fesMarathons|trainingEvents)/{num}/top",jo],["userShops/actions/purchase",e=>{So(null==e?void 0:e.shopMerchandise,"title"),_o(null==e?void 0:e.shopMerchandise,"comment")}],["produces/{num}/actions/ready",Co],["userPresents/{num}/actions/receive",e=>{So(e.receivedPresent,"Name")}],["userMissions/{num}/actions/receive",e=>{So(e.userMission.mission.missionReward.content,"name")}],["userLoginBonuses",e=>{e.userLoginBonuses.forEach(e=>{e.loginBonus.sheets.forEach(e=>{e.rewards.forEach(e=>{So(e.content,"name")})})}),e.userTotalBonuses.forEach(e=>{e.rewards.forEach(e=>{So(e.content,"name")})})}],["fesTop",e=>{e.lastRankingResult&&Array.isArray(e.lastRankingResult.fesMatchGradeRewards)&&e.lastRankingResult.fesMatchGradeRewards.forEach(e=>{So(e.content,"name")})}],["userSelectLoginBonuses/{num}",e=>{e.rewards.forEach(e=>{So(e.content,"name")})}],["gashas/{num}/actions/draw",e=>{var t;null===(t=e.acquiredStampRewards)||void 0===t||t.forEach(e=>{So(e.content,"name")})}]]),bo.patch([["produces/{num}/produceItem/consume",e=>{var t;const r=null===(t=e.consumeProduceItem)||void 0===t?void 0:t.produceItem;r&&(So(r,"name"),_o(r,"comment"))}]]);const{api:To,transItem:Ro}=fn("mission",ko),Po=(e,t)=>{Ro(e,t)||("name"===t?So(e,t):_o(e,t))},Oo=e=>{null==e||e.forEach(e=>{Ro(e.mission,"title"),Ro(e.mission,"comment"),e.mission.missionReward.content&&(Po(e.mission.missionReward.content,"name"),Po(e.mission.missionReward.content,"comment"))})},Do=e=>{e.forEach(e=>{let t=e.fesRaidAccumulatedReward;Ro(t,"title"),Ro(t,"comment");let r=t.fesRaidAccumulatedRewardContent;null!=r&&r.content&&(Po(r.content,"name"),Po(r.content,"comment"))})},Fo=(e,t=!0)=>{null==e||e.forEach(e=>{let r=e.mission||e;if(Ro(r,"title"),Ro(r,"comment"),Ro(r,"afterAchievedComment"),Ro(r,"beforeAchievedComment"),t){let e=r.lectureMissionReward;null!=e&&e.content&&(Po(e.content,"name"),Po(e.content,"comment"))}})},zo=e=>{var t,r;Ro(null===(t=e.userRecommendedMission)||void 0===t?void 0:t.mission,"comment"),Ro(null===(r=e.userRecommendedMission)||void 0===r?void 0:r.mission,"title"),e.accumulatedPresent.userGameEventAccumulatedPresents.forEach(e=>{Ro(e.gameEventAccumulatedPresent,"comment"),Ro(e.gameEventAccumulatedPresent,"title")})},Lo=e=>{var t;null===(t=e.teachingHints)||void 0===t||t.forEach(e=>{var t,r;null===(t=e.userProduceHints)||void 0===t||t.forEach(e=>{Ro(e.produceTeachingHint,"title")}),null===(r=e.userProduceTeachingHints)||void 0===r||r.forEach(e=>{Ro(e.produceTeachingHint,"title")})})},$o=e=>{Fo(e.lectureMissions)},No=e=>{var t;null===(t=e.userIdolRoad)||void 0===t||t.idolRoad.idolRoadRewards.forEach(e=>{Po(e.content,"name"),Po(e.content,"comment")})};To.get([["userMissions",e=>{var t;Oo(e.dailyUserMissions),Oo(e.weeklyUserMissions),null===(t=e.eventUserMissions)||void 0===t||t.forEach(e=>{Oo(null==e?void 0:e.userMissions)}),Oo(e.normalUserMissions),Oo(e.specialUserMissions),Oo(e.fesMatchRankingUserMissions)}],["fesRaidEvents/{num}/rewards",e=>{Do(e.fesRaidBestScoreRewards),Do(e.fesRaidLapRewards),Do(e.fesRaidPointRewards)}],["userProduces",[Lo]],["userBeginnerMissions/top",$o],["idolRoads/top",e=>{var t;Fo(e.userMissions,!1),null===(t=e.userIdols)||void 0===t||t.forEach(No)}],["missionEvents/{num}/top",[zo]],["producerDesk/rewards",e=>{e.producerLevelRewards.forEach(e=>{Ro(e,"title"),Po(e.content,"name")})}]]),To.post([["myPage",[e=>{Oo(e.reportUserMissions)},e=>{let t=e.beginnerMission;t&&(t.clearedLectureMission&&Fo([t.clearedLectureMission]),t.progressLectureMission&&Fo([t.progressLectureMission]))},e=>{var t;(e=>{if(!e)return;const t=[];for(let r=0;r<e.length;r++){let n=e[r];Ro(e,r),n===e[r]&&t.push(n)}T.dev&&t.length&&J(t.join("\n"))})(null===(t=e.producerDesk)||void 0===t?void 0:t.messages)}]],["(produceMarathons|fesMarathons|trainingEvents)/{num}/top",[zo]],[["produceTeachings/resume","produceTeachings/next"],Lo],["userLectureMissions/{num}/actions/receive",$o],["producerDesk/top",e=>{e.progresses.forEach(e=>{Ro(e,"comment"),Ro(e,"title")})}]]),To.put([["userIdolRoads",e=>{No(e.userIdol)}]]);const Bo=new Map,Uo=new Map,Ho=new Map;let Wo=!1;let Jo,qo,Go,Ko;const Vo=async()=>{Go||(Go=(async()=>{if(!Wo){(await nn("title")).forEach(e=>{if(null!=e&&e.text){const t=U(e.text),r=U(e.trans,!0),n=B(e.type)||"text";t&&r&&t!==r&&("exp"===n?Uo.set(t,r):"text"===n&&Bo.set(t,r))}});for(let[e,t]of Uo){const r=sn(e);Ho.set(r,t)}Wo=!0}return{textMap:Bo,expMap:Ho}})(),Ko=un()),Jo&&qo||(Jo=await Go,qo=await Ko,Jo.wordMaps=[qo])};let Qo=[];(window.unsafeWindow||window).printUnknowTitles=()=>J(Qo.join("\n"));const Zo=new Map,Yo=(e,t)=>{e&&v(t)&&(Zo.has(e)||Zo.set(e,t))},Xo=(e={},t)=>{let r=e[t];ee(e,t,Jo),r===e[t]&&T.dev&&(e=>{if(!e)return;let t=G(e);Qo.includes(t)||Qo.push(t)})(r)},es=e=>{e.forEach(e=>{Xo(e,"name"),e.communications.forEach(e=>{Xo(e,"name"),Xo(e,"title"),Yo(e.id,`${e.name}-${e.title}`)})})};Nr.get([[["userSupportIdols/{num}","userSupportIdols/statusMax","produceTeachingSupportIdols/{num}"],async e=>{await Vo(),e.supportIdol.produceSupportIdolEvents.forEach(e=>{Xo(e,"title"),Yo(e.id,e.title)})}],[["userIdols/{num}","userIdols/statusMax","produceTeachingIdols/{num}"],async e=>{await Vo(),e.idol.produceAfterEvents.forEach(e=>{Xo(e,"title"),Yo(e.id,e.title)}),e.idol.produceIdolEvents.forEach(e=>{Xo(e,"title"),Yo(e.id,e.title)})}],[["characterAlbums","album/top"],async e=>{await Vo(),es(e.gameEvents),es(e.specialEvents)}]]),Nr.post([["characterAlbums/characters/{num}",async e=>{await Vo(),e.albumCommunicationTitles.forEach(e=>{Xo(e,"title")}),e.communications.forEach(e=>{Xo(e,"title"),Yo(e.communicationId,e.title)}),e.voices.forEach(e=>{Xo(e,"title"),Xo(e,"releasedConditionComment")})}],["produceMarathons/{num}/top",async e=>{await Vo(),e.releasedCommunications.forEach(e=>{Xo(e,"name"),Xo(e,"title"),Yo(e.id,`${e.name}-${e.title}`)}),Xo(e.gameEvent,"name")}]]);const ts=async e=>{const t=await pn();if(e.userProduceIdol){const r=e.userProduceIdol.userIdol.idol.character;t.has(r.name)&&(r.name=t.get(r.name)),t.has(r.firstName)&&(r.firstName=t.get(r.firstName))}},rs=async e=>{var t;await Vo(),null===(t=e.produceEvents)||void 0===t||t.forEach(e=>{Xo(e,"title"),Yo(e.id,e.title)})};Nr.get([["userProduceAreas",async e=>{var t;await Vo(),null===(t=e.produceHintSettings)||void 0===t||t.forEach(e=>{Xo(e,"title")})}]]),Nr.post([["myPage",async e=>{var t;await Vo(),Xo(null==e||null===(t=e.userProduce)||void 0===t?void 0:t.produce,"title")}],["produces/actions/(resume|next)",[rs,ts]],[["produces/actions/resume","produces/actions/finish","produceTeachings/resume"],rs],["produces/actions/act",rs],["produces/({num}/audition|concert)/actions/(start|finish)",ts]]);const ns=on({name:"etc/noun-fix",keys:{trans:"fixed"},sort:"text",ignoreTrans:!0}),os=on({name:"etc/caiyun-prefix",keys:{trans:"fixed"},sort:"text",ignoreTrans:!0}),ss=new Map,as=new Map,is=new Map;let cs=!1,ls=null,us=null;const ds=(e,t)=>{const r=Zr(e),n=new Map,o=Q(),s=r.find(e=>"译者"===e.id).name||"";return r.forEach(e=>{const t=o(B(e.id)),r=U(e.text);let s=U(e.trans,!0);const a=B(e.name);r&&s&&(t&&!/^0+$/.test(t)&&"select"!==t?n.set(t,s):"select"===t?n.set(r+"-select",s):n.set(r,s)),t&&a&&"info"===t&&n.set("name",a)}),t&&n.set("isAI",`这段剧情由 ${s}(LLM) 机翻`),n},ps=async()=>{if(!cs){(await nn("comm-story")).forEach(e=>{if(null!=e&&e.text){const t=U(e.text),r=U(e.trans,!0);t&&r&&t!==r&&is.set(t,r)}}),cs=!0}return is};let fs=null,hs=!1;const ms=on({name:"type-text"}),gs=async()=>{if(!hs){fs=await ms();const e=await ps(),t=await pn();fs=new Map([...e,...fs,...t]),hs=!0}return fs},vs=!!window.GM_xmlhttpRequest,ys=(e,t={})=>{const{method:r="GET",headers:n,responseType:o="json",data:s,cors:a=!1,credentials:i}=t;return a?fetch(e,{body:s,headers:n,method:r,mode:"cors",credentials:i}).then(e=>e.json()):new Promise((t,a)=>{if(!vs)return a("GM_XHR MISSING");window.GM_xmlhttpRequest({method:r,url:e,headers:n,responseType:o,data:s,onload({status:e,responseText:r,statusText:n}){if(e>=200&&e<300)if("json"===o){const e=JSON.parse(r);t(e)}else t(r);else a(n)},onerror(e){a(e)}})})};var ws=function(e,t){e=[e[0]>>>16,65535&e[0],e[1]>>>16,65535&e[1]],t=[t[0]>>>16,65535&t[0],t[1]>>>16,65535&t[1]];var r=[0,0,0,0];return r[3]+=e[3]+t[3],r[2]+=r[3]>>>16,r[3]&=65535,r[2]+=e[2]+t[2],r[1]+=r[2]>>>16,r[2]&=65535,r[1]+=e[1]+t[1],r[0]+=r[1]>>>16,r[1]&=65535,r[0]+=e[0]+t[0],r[0]&=65535,[r[0]<<16|r[1],r[2]<<16|r[3]]},bs=function(e,t){e=[e[0]>>>16,65535&e[0],e[1]>>>16,65535&e[1]],t=[t[0]>>>16,65535&t[0],t[1]>>>16,65535&t[1]];var r=[0,0,0,0];return r[3]+=e[3]*t[3],r[2]+=r[3]>>>16,r[3]&=65535,r[2]+=e[2]*t[3],r[1]+=r[2]>>>16,r[2]&=65535,r[2]+=e[3]*t[2],r[1]+=r[2]>>>16,r[2]&=65535,r[1]+=e[1]*t[3],r[0]+=r[1]>>>16,r[1]&=65535,r[1]+=e[2]*t[2],r[0]+=r[1]>>>16,r[1]&=65535,r[1]+=e[3]*t[1],r[0]+=r[1]>>>16,r[1]&=65535,r[0]+=e[0]*t[3]+e[1]*t[2]+e[2]*t[1]+e[3]*t[0],r[0]&=65535,[r[0]<<16|r[1],r[2]<<16|r[3]]},Es=function(e,t){return 32===(t%=64)?[e[1],e[0]]:t<32?[e[0]<<t|e[1]>>>32-t,e[1]<<t|e[0]>>>32-t]:(t-=32,[e[1]<<t|e[0]>>>32-t,e[0]<<t|e[1]>>>32-t])},ks=function(e,t){return 0===(t%=64)?e:t<32?[e[0]<<t|e[1]>>>32-t,e[1]<<t]:[e[1]<<t-32,0]},_s=function(e,t){return[e[0]^t[0],e[1]^t[1]]},Ss=function(e){return e=_s(e,[0,e[0]>>>1]),e=bs(e,[4283543511,3981806797]),e=_s(e,[0,e[0]>>>1]),e=bs(e,[3301882366,444984403]),e=_s(e,[0,e[0]>>>1])};const xs="function"==typeof Buffer,Is="function"==typeof TextDecoder?new TextDecoder:void 0,As=("function"==typeof TextEncoder&&new TextEncoder,Array.prototype.slice.call("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=")),Cs=(e=>{let t={};return e.forEach((e,r)=>t[e]=r),t})(As),js=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,Ms=String.fromCharCode.bind(String),Ts="function"==typeof Uint8Array.from?Uint8Array.from.bind(Uint8Array):e=>new Uint8Array(Array.prototype.slice.call(e,0)),Rs=e=>e.replace(/[^A-Za-z0-9\+\/]/g,""),Ps=e=>{let t,r,n,o,s="";const a=e.length%3;for(let a=0;a<e.length;){if((r=e.charCodeAt(a++))>255||(n=e.charCodeAt(a++))>255||(o=e.charCodeAt(a++))>255)throw new TypeError("invalid character found");t=r<<16|n<<8|o,s+=As[t>>18&63]+As[t>>12&63]+As[t>>6&63]+As[63&t]}return a?s.slice(0,a-3)+"===".substring(a):s},Os=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,Ds=e=>{switch(e.length){case 4:var t=((7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3))-65536;return Ms(55296+(t>>>10))+Ms(56320+(1023&t));case 3:return Ms((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return Ms((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}},Fs=e=>e.replace(Os,Ds),zs=e=>{if(e=e.replace(/\s+/g,""),!js.test(e))throw new TypeError("malformed base64.");let t,r,n;e+="==".slice(2-(3&e.length));let o=[];for(let s=0;s<e.length;)t=Cs[e.charAt(s++)]<<18|Cs[e.charAt(s++)]<<12|(r=Cs[e.charAt(s++)])<<6|(n=Cs[e.charAt(s++)]),64===r?o.push(Ms(t>>16&255)):64===n?o.push(Ms(t>>16&255,t>>8&255)):o.push(Ms(t>>16&255,t>>8&255,255&t));return o.join("")},Ls="function"==typeof atob?e=>atob(Rs(e)):xs?e=>Buffer.from(e,"base64").toString("binary"):zs,$s=xs?e=>Ts(Buffer.from(e,"base64")):e=>Ts(Ls(e).split("").map(e=>e.charCodeAt(0))),Ns=xs?e=>Buffer.from(e,"base64").toString("utf8"):Is?e=>Is.decode($s(e)):e=>Fs(Ls(e)),Bs=e=>Rs(e.replace(/[-_]/g,e=>"-"==e?"+":"/")),Us=e=>Ns(Bs(e)),Hs=Us;function Ws(e){this.message=e}Ws.prototype=new Error,Ws.prototype.name="InvalidCharacterError";var Js="undefined"!=typeof window&&window.atob&&window.atob.bind(window)||function(e){var t=String(e).replace(/=+$/,"");if(t.length%4==1)throw new Ws("'atob' failed: The string to be decoded is not correctly encoded.");for(var r,n,o=0,s=0,a="";n=t.charAt(s++);~n&&(r=o%4?64*r+n:n,o++%4)?a+=String.fromCharCode(255&r>>(-2*o&6)):0)n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(n);return a};function qs(e){var t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw"Illegal base64url string!"}try{return function(e){return decodeURIComponent(Js(e).replace(/(.)/g,(function(e,t){var r=t.charCodeAt(0).toString(16).toUpperCase();return r.length<2&&(r="0"+r),"%"+r})))}(t)}catch(e){return Js(t)}}function Gs(e){this.message=e}Gs.prototype=new Error,Gs.prototype.name="InvalidTokenError";let Ks="",Vs="";const Qs=()=>{let e="0123456789abcdefghijklmnopqrstuvwxyz",t="";for(let r=0;r<33;r++)t+=e[Math.floor(Math.random()*e.length)];Ks=function(e,t){t=t||0;for(var r=(e=e||"").length%16,n=e.length-r,o=[0,t],s=[0,t],a=[0,0],i=[0,0],c=[2277735313,289559509],l=[1291169091,658871167],u=0;u<n;u+=16)a=[255&e.charCodeAt(u+4)|(255&e.charCodeAt(u+5))<<8|(255&e.charCodeAt(u+6))<<16|(255&e.charCodeAt(u+7))<<24,255&e.charCodeAt(u)|(255&e.charCodeAt(u+1))<<8|(255&e.charCodeAt(u+2))<<16|(255&e.charCodeAt(u+3))<<24],i=[255&e.charCodeAt(u+12)|(255&e.charCodeAt(u+13))<<8|(255&e.charCodeAt(u+14))<<16|(255&e.charCodeAt(u+15))<<24,255&e.charCodeAt(u+8)|(255&e.charCodeAt(u+9))<<8|(255&e.charCodeAt(u+10))<<16|(255&e.charCodeAt(u+11))<<24],a=bs(a,c),a=Es(a,31),a=bs(a,l),o=_s(o,a),o=Es(o,27),o=ws(o,s),o=ws(bs(o,[0,5]),[0,1390208809]),i=bs(i,l),i=Es(i,33),i=bs(i,c),s=_s(s,i),s=Es(s,31),s=ws(s,o),s=ws(bs(s,[0,5]),[0,944331445]);switch(a=[0,0],i=[0,0],r){case 15:i=_s(i,ks([0,e.charCodeAt(u+14)],48));case 14:i=_s(i,ks([0,e.charCodeAt(u+13)],40));case 13:i=_s(i,ks([0,e.charCodeAt(u+12)],32));case 12:i=_s(i,ks([0,e.charCodeAt(u+11)],24));case 11:i=_s(i,ks([0,e.charCodeAt(u+10)],16));case 10:i=_s(i,ks([0,e.charCodeAt(u+9)],8));case 9:i=_s(i,[0,e.charCodeAt(u+8)]),i=bs(i,l),i=Es(i,33),i=bs(i,c),s=_s(s,i);case 8:a=_s(a,ks([0,e.charCodeAt(u+7)],56));case 7:a=_s(a,ks([0,e.charCodeAt(u+6)],48));case 6:a=_s(a,ks([0,e.charCodeAt(u+5)],40));case 5:a=_s(a,ks([0,e.charCodeAt(u+4)],32));case 4:a=_s(a,ks([0,e.charCodeAt(u+3)],24));case 3:a=_s(a,ks([0,e.charCodeAt(u+2)],16));case 2:a=_s(a,ks([0,e.charCodeAt(u+1)],8));case 1:a=_s(a,[0,e.charCodeAt(u)]),a=bs(a,c),a=Es(a,31),a=bs(a,l),o=_s(o,a)}return o=_s(o,[0,e.length]),s=_s(s,[0,e.length]),o=ws(o,s),s=ws(s,o),o=Ss(o),s=Ss(s),o=ws(o,s),s=ws(s,o),("00000000"+(o[0]>>>0).toString(16)).slice(-8)+("00000000"+(o[1]>>>0).toString(16)).slice(-8)+("00000000"+(s[0]>>>0).toString(16)).slice(-8)+("00000000"+(s[1]>>>0).toString(16)).slice(-8)}(t,31),Vs="",localStorage.setItem("sczh:bid",Ks),localStorage.setItem("sczh:caiyun-jwt",Vs)};const Zs=()=>{try{const{exp:e}=function(e,t){if("string"!=typeof e)throw new Gs("Invalid token specified");var r=!0===(t=t||{}).header?0:1;try{return JSON.parse(qs(e.split(".")[r]))}catch(e){throw new Gs("Invalid token specified: "+e.message)}}(Vs);1e3*e<Date.now()&&(Vs="")}catch(e){}};try{Ks=localStorage.getItem("sczh:bid"),Vs=localStorage.getItem("sczh:caiyun-jwt"),Zs()}catch(Ws){}Ks||Qs();const Ys=async(e,t="ja")=>{if(await(async()=>{if(Zs(),Vs)return;const e=await ys("https://api.interpreter.caiyunai.com/v1/user/jwt/generate",{method:"POST",headers:{"X-Authorization":"token:"+Gr.data.cyweb_token,"Content-Type":"application/json",origin:"https://fanyi.caiyunapp.com",referer:"https://fanyi.caiyunapp.com/","Device-Id":Ks},data:JSON.stringify({browser_id:Ks})});e.jwt?(Vs=e.jwt,localStorage.setItem("sczh:caiyun-jwt",Vs)):Qs()})(),!Vs)return[];const r=await ys("https://api.interpreter.caiyunai.com/v1/translator",{cors:!0,method:"POST",headers:{"X-Authorization":"token:"+Gr.data.cyweb_token,"Content-Type":"application/json","Device-Id":Ks,"T-Authorization":Vs},data:JSON.stringify({cached:!0,os_type:"web",replaced:!0,request_id:"web_fanyi",source:e,trans_type:t+"2zh",style:"formal",media:"text",dict:!0,detect:!0,browser_id:Ks})});return r&&r.target?r.target.map(e=>Hs(function(e){const t=e=>"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".indexOf(e);return e.split("").map(e=>t(e)>-1?"NOPQRSTUVWXYZABCDEFGHIJKLMnopqrstuvwxyzabcdefghijklm"[t(e)]:e).join("")}(e))):(Qs(),[])};var Xs=function(){return o.Date.now()},ea=/\s/;var ta=function(e){for(var t=e.length;t--&&ea.test(e.charAt(t)););return t},ra=/^\s+/;var na=function(e){return e?e.slice(0,ta(e)+1).replace(ra,""):e};var oa=function(e){return"symbol"==typeof e||g(e)&&"[object Symbol]"==h(e)},sa=/^[-+]0x[0-9a-f]+$/i,aa=/^0b[01]+$/i,ia=/^0o[0-7]+$/i,ca=parseInt;var la=function(e){if("number"==typeof e)return e;if(oa(e))return NaN;if(me(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=me(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=na(e);var r=aa.test(e);return r||ia.test(e)?ca(e.slice(2),r?2:8):sa.test(e)?NaN:+e},ua=Math.max,da=Math.min;var pa=function(e,t,r){var n,o,s,a,i,c,l=0,u=!1,d=!1,p=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function f(t){var r=n,s=o;return n=o=void 0,l=t,a=e.apply(s,r)}function h(e){return l=e,i=setTimeout(g,t),u?f(e):a}function m(e){var r=e-c;return void 0===c||r>=t||r<0||d&&e-l>=s}function g(){var e=Xs();if(m(e))return v(e);i=setTimeout(g,function(e){var r=t-(e-c);return d?da(r,s-(e-l)):r}(e))}function v(e){return i=void 0,p&&n?f(e):(n=o=void 0,a)}function y(){var e=Xs(),r=m(e);if(n=arguments,o=this,c=e,r){if(void 0===i)return h(c);if(d)return clearTimeout(i),i=setTimeout(g,t),f(c)}return void 0===i&&(i=setTimeout(g,t)),a}return t=la(t)||0,me(r)&&(u=!!r.leading,s=(d="maxWait"in r)?ua(la(r.maxWait)||0,t):s,p="trailing"in r?!!r.trailing:p),y.cancel=function(){void 0!==i&&clearTimeout(i),l=0,n=c=o=i=void 0},y.flush=function(){return void 0===i?a:v(Xs())},y};const fa=`\n  <style>\n  #sczh-story-tool {\n    position: absolute;\n    display: none;\n    background: #ffffff;\n    border-radius: 24px;\n    box-sizing: border-box;\n    font-family: HummingStd-E;\n    align-items: center;\n    justify-content: center;\n    color: #ff6499;\n    text-shadow: 0 0 6px #fff;\n    cursor: pointer;\n    user-select: none;\n    width: 100px;\n    height: 100px;\n    font-size: 32px;\n    border: 7px solid transparent;\n    border-image: url(${T.origin}/data/image/border.png);\n    border-image-slice: 7;\n    transform-origin: top right;\n    transition: opacity 0.3s;\n  }\n  .story-tool-btns {\n    width: 100%;\n    height: 100%;\n    display: none;\n  }\n  .story-tool-btns .btn-download-sczh,\n  .story-tool-btns label {\n    flex: 1;\n    height: 100%;\n    background: #fff;\n    display: flex;\n    box-sizing: content-box;\n    align-items: center;\n    justify-content: center;\n    cursor: pointer;\n    color: #c0aade;\n    text-shadow: 0 0 6px #fff;\n  }\n  .story-tool-btns .btn-download-sczh:hover {\n    color: #9f66ec;\n  }\n  .story-tool-btns label {\n    color: rgb(242, 156, 199);\n    border-right: 1px solid #c9c9c9;\n  }\n  #sczh-story-tool .btn-close-sczh {\n    height: 25px;\n    width: 50px;\n    background: rgba(0, 0, 0, 0.58);\n    color: #fff;\n    letter-spacing: 2px;\n    position: absolute;\n    right: -25px;\n    top: -20px;\n    border-radius: 4px;\n    display: none;\n    align-items: center;\n    justify-content: center;\n    z-index: 1;\n    font-family: UDKakugo_SmallPr6-B;\n    font-size: 15px;\n  }\n  #sczh-story-tool:hover {\n    width: 200px;\n  }\n  #sczh-story-tool:hover .story-tool-btns {\n    display: flex;\n  }\n  #sczh-story-tool:hover .btn-close-sczh {\n    display: flex;\n  }\n  #sczh-story-tool:hover > .text-sczh {\n    display: none;\n  }\n  #sczh-story-tool .btn-close-sczh:hover {\n    background: rgba(0, 0, 0, 0.9);\n  }\n  #sczh-story-tool.blur {\n    opacity: 0.2;\n  }\n  .story-tool-btns label:hover {\n    color: #f270b1;\n  }\n  .story-tool-btns .btn-download-sczh:hover,\n  .story-tool-btns label:hover {\n    background-color: #f7f7f7;\n  }\n  </style>\n  <div id="sczh-story-tool"><span class="text-sczh">剧情</span>\n    <span id="btn-close-sczh" class="btn-close-sczh">关闭</span>\n    <input type="file" style="display:none" id="ipt-preview-sczh" multiple accept=".csv">\n    <div class="story-tool-btns">\n      <label for="ipt-preview-sczh">预览</label>\n      <div id="btn-download-sczh" class="btn-download-sczh">下载</div>\n    </div>\n  </div>\n  `;let ha=!1;const ma=e=>{if(ha)return;ha=!0,document.body.insertAdjacentHTML("beforeend",fa);const t=document.getElementById("sczh-story-tool"),r=pa(()=>{const r=[.017,.22],n=window.innerHeight,o=window.innerWidth;let s=n,a=o,i=0,c=0;n/o>9/16?(s=9*o/16,i=(n-s)/2):(a=16*n/9,c=(o-a)/2),t.style.right=Math.floor(c+r[0]*a)+"px",t.style.top=Math.floor(i+r[1]*s)+"px",t.style.transform=`scale(${(s/900).toFixed(3)})`,e.name?t.style.display="flex":t.style.display="none"},300);r(),window.addEventListener("resize",r);document.getElementById("btn-download-sczh").addEventListener("click",(function(){if(e.name){((e,t)=>{const r=document.createElement("a");r.download=t,r.style.display="none";const n=new Blob([e],{type:"text/csv"});r.href=URL.createObjectURL(n),document.body.appendChild(r),r.click(),document.body.removeChild(r)})(Qr.unparse(e.list),e.filename)}}));document.getElementById("btn-close-sczh").addEventListener("click",(function(){t.style.display="none",T.story="normal",D()}));let n;document.getElementById("ipt-preview-sczh").addEventListener("change",(function(){const t=[...this.files];t.length&&t.forEach(t=>{const r=new FileReader;r.onload=t=>{const r=t.target.result,n=ds(r);if(n.has("name")){const t=n.get("name");e.preview.set(t,n),(e=>{const t=[...e].slice(-5).map(e=>(e[1]=[...e[1]],e));sessionStorage.setItem("sczh:preview",JSON.stringify(t))})(e.preview),alert(`导入${t}成功`)}},r.readAsText(t)})})),t.addEventListener("mouseenter",()=>{clearTimeout(n),t.classList.remove("blur")});const o=()=>{clearTimeout(n),n=setTimeout(()=>{t.classList.add("blur")},5e3)};t.addEventListener("mouseleave",o),o()},ga=new Map;let va=!1;let ya=null,wa=new Map;const ba=async()=>(ya||(ya=pn(),wa=(await(async()=>{if(!va){(await nn("speaker-icon")).forEach(e=>{let{name:t,id:r,type:n}=e;t=B(t),r=B(r),n=B(n),t&&r&&ga.set(r,t)}),va=!0}return{iconMap:ga}})()).iconMap),await ya);let Ea=!1,ka=!1;const _a=(e,t)=>{var r,n,o,s,a,i,c,l,u,d,p,f;return(!Ea||!ka)&&("idol"===t&&null!==(r=e[0])&&void 0!==r&&null!==(n=r["002"])&&void 0!==n&&n.includes&&null!==(o=e[0])&&void 0!==o&&null!==(s=o["002"])&&void 0!==s&&s.includes("灯織")?(Ea=!0,null===(u=e[0])||void 0===u||null===(d=u["002"])||void 0===d?void 0:d.includes("灯織")):null!==(a=e[0])&&void 0!==a&&null!==(i=a[901])&&void 0!==i&&i.includes&&null!==(c=e[0])&&void 0!==c&&null!==(l=c[901])&&void 0!==l&&l.includes("はづき")?(ka=!0,null===(p=e[0])||void 0===p||null===(f=p[901])||void 0===f?void 0:f.includes("はづき")):void 0)},Sa=Object.keys;Object.keys=new Proxy(Sa,{apply(e,t,r){if(_a(r,"idol")||_a(r,"staff"))for(let[e,t]of wa){let n=t;Array.isArray(r[0][e])&&!r[0][e].includes(n)&&r[0][e].push(n)}return Reflect.apply(e,t,r)}});const xa=(e,t)=>{let r=e,n="";return/[0-9０-９]$/.test(e)&&(n=e.match(/([0-9０-９])$/)[1],r=e.slice(0,e.length-1)),t.has(r)?t.get(r)+n:e},Ia=async e=>{if(e.speaker){const t=await ba();let r=B(e.speaker);if(t.has(r))return e.speaker=t.get(r);["＆","&"].forEach(e=>{r=((e,t,r)=>{const n=e.split(t);for(let e=0;e<n.length;e++)n[e]=xa(n[e],r);return n.join(t)})(r,e,t)}),r!==e.speaker&&(e.speaker=r)}};let Aa=null;const Ca=new Map([["AOBA",e=>e&&e.loaders&&e.Text&&e.BLEND_MODES],["SCENARIO",e=>e&&e.A&&e.A.load&&e.A._errorEvent&&e.A._handleError],["PHRASE",e=>{var t,r;return null==e||null===(t=e.A)||void 0===t||null===(r=t._polyglot)||void 0===r?void 0:r.phrases}],["WEBP",e=>{var t;return null==e||null===(t=e.A)||void 0===t?void 0:t.isSupportedWebP}],["TRACK_MANAGER",e=>{var t;return null==e||null===(t=e.A)||void 0===t?void 0:t.TrackManager}]]),ja=new Map([["AOBA",e=>e],["SCENARIO",e=>e.A],["PHRASE",e=>e.A._polyglot.phrases],["WEBP",e=>e.A],["TRACK_MANAGER",e=>e.A.TrackManager]]),Ma=Object.freeze;Object.freeze=new Proxy(Ma,{apply:(e,t,[r])=>r});const Ta=/^function\s\w\((\w)\){var\s(\w)=(\w)\[\1\];if\(void\s0!==\2\)return\s\2\.exports;var\s(\w)=\3\[\1\]={id:\1,loaded:!1,exports:{}};return\s\w\[\1\]\.call\(\4\.exports,\4,\4\.exports,\w\),\4\.loaded=!0,\4\.exports}$/,Ra=Function.prototype.call;let Pa={Reflect:window.Reflect};Function.prototype.call=new Proxy(Ra,{apply(e,t,r){var n;return null!=r&&null!==(n=r[3])&&void 0!==n&&n.toString&&Ta.test(r[3].toString())&&(Aa=r[3],Function.prototype.call=Ra),Pa.Reflect.apply(e,t,r)}});const Oa=async e=>{const{moduleId:t}=await Kr;let[r,n]=((e,t)=>{let r,n,o=((e,t)=>{let r=e+t,n=[];for(let o=e-t;o<=r;o++)o>=0&&o!==e&&n.push(o);return n.unshift(e),n})(e,50);for(let e=0;e<o.length;e++){let s;try{s=Aa(o[e])}catch(e){}if(t(s)){r=s,n=o[e];break}}return[r,n]})(t[e],Ca.get(e));return r?ja.get(e)(r):null};let Da=!1;const Fa=e=>{const t=(()=>{if(!Da){Da=!0,document.body.insertAdjacentHTML("beforeend",'\n  <style>\n  #sczh-trans-cover {\n    color: #575453;\n    font-family: HummingStd-E;\n    position: absolute;\n    transform-origin: left center;\n    text-align: left;\n    font-size: 18px;\n    mix-blend-mode: multiply;\n  }\n  #sczh-trans-cover.hide {\n    display: none;\n  }\n  </style>\n  <div id="sczh-trans-cover" class="hide">\n  </div>\n  ');const e=document.getElementById("sczh-trans-cover"),t=pa(()=>{const t=[.202,.942],r=window.innerHeight,n=window.innerWidth;let o=r,s=n,a=0,i=0,c=1;r/n>9/16?(o=9*n/16,a=(r-o)/2,c=s/1600*1.6):(s=16*r/9,i=(n-s)/2,c=o/900*1.6),e.style.left=Math.floor(i+t[0]*s)+"px",e.style.top=Math.floor(a+t[1]*o)+"px",e.style.maxWidth=Math.floor(.5*s)+"px",e.style.transform=`scale(${c.toFixed(3)}) translateY(-50%)`},300);t(),window.addEventListener("resize",t)}return document.getElementById("sczh-trans-cover")})();t.classList.remove("hide"),function(e,t,r=100){"string"!=typeof e?(console.error("Typewriter Error: text must be a string."),Promise.reject(new Error("text must be a string."))):t instanceof HTMLElement?(("number"!=typeof r||r<=0)&&(console.warn(`Typewriter Warning: Invalid interval (${r}), using default 100ms.`),r=100),new Promise(n=>{t._typewriterTimerId&&clearInterval(t._typewriterTimerId);let o=0;if(t.textContent="",0===e.length)return delete t._typewriterTimerId,void n();const s=setInterval(()=>{o<e.length?(t.textContent+=e[o],o++):(clearInterval(s),delete t._typewriterTimerId,n())},r);t._typewriterTimerId=s})):(console.error("Typewriter Error: box must be an HTMLElement."),Promise.reject(new Error("box must be an HTMLElement.")))}(e,t)},za=(e,t,r,n)=>{const o=e(n.id),s=W(n.text);let a="";return o&&t.has(""+o)?a=t.get(""+o):t.has(s)?a=t.get(s):r.has(s)&&(a=r.get(s)),a};let La=null,$a=null,Na=!0,Ba=null;function Ua(e,t){La=e,$a=t}const Ha=new WeakMap;"on"===T.transCover&&function(){const e=setInterval(async()=>{try{const t=await Oa("TRACK_MANAGER");if(t&&t.prototype){clearInterval(e),J("TrackManager found. Proceeding to modify getter.");const r=t.prototype,n="currentTrack",o=Object.getOwnPropertyDescriptor(r,n);if(!o||"function"!=typeof o.get)return void console.error(`Property '${n}' or its getter not found on TrackManager prototype.`);J(`Original descriptor for '${n}':`,o);const s=o.get;Object.defineProperty(r,n,{get:function(){let e;try{e=s.call(this)}catch(t){J(`Error calling original getter for ${n}:`,t),e=void 0}const t=Ha.get(this);return e!==t&&(!function(e,t,r){if(J("%cTrack changed!","color: green; font-weight: bold;"),J("  New Value:",t),La&&t){if(Na&&(Ba=Q(),Na=!1),"end"===t.label&&(Na=!0,Fa("")),t.text){const e=za(Ba,La,$a,t);Fa(e)}"off"===t.textFrame&&Fa("")}}(0,e),Ha.set(this,e)),e},set:o.set,enumerable:o.enumerable,configurable:!0}),J(`Successfully redefined getter for '${n}' on TrackManager.prototype.`)}else J("TrackManager or its prototype not found yet, waiting...")}catch(e){J("Error during TrackManager check/modification:",e)}},500);setTimeout(()=>{e&&(clearInterval(e),J("Stopped checking for TrackManager after timeout."))},3e4)}();const Wa={name:"",filename:"",list:"",preview:new Map};let Ja=!1;const qa=(e,t,r)=>{Ua(null,null),"on"===T.transCover&&Ua(t,r);const n=Q();e.forEach(e=>{if(e.text&&"on"!==T.transCover){const o=za(n,t,r,e);o&&(e.text=o)}if(e.select){const n=((e,t,r)=>{const n=W(r.select),o=n+"-select";let s="";return e.has(o)?s=e.get(o):t.has(n)&&(s=t.get(r.select)),s})(t,r,e);n&&(e.select=n)}}),t.has("isAI")&&Qa(t.get("isAI"))},Ga=async()=>{const e=await Oa("SCENARIO"),t=e.load;e.load=async function(...e){const r=await t.apply(this,e),n=e[0];if(!n)return r;if(T.dev&&n.includes("/assets/json/")&&Or("STORY","#ad37c2",e,r),n.includes("/produce_events/")||n.includes("/produce_communications/")||n.includes("/produce_communications_promises/")||n.includes("/produce_communication_promise_results/")||n.includes("/game_event_communications/")||n.includes("/special_communications/")||n.includes("/mypage_communications/")||n.includes("/produce_communication_cheers/")||n.includes("/produce_communication_auditions/")||n.includes("/produce_communication_televisions/")||n.includes("/business_unit_communication/"))try{if(Ua(null),!Array.isArray(r))return r;const e=n.replace(/^\/assets\/json\//,"");let t;"edit"===T.story&&(((e,t)=>{const r=t.replace(".json",""),n=(e=>{var t;const r=e.match(/\/(\d+)$/);return null!==(t=null==r?void 0:r[1])&&void 0!==t?t:""})(r);let o=Zo.get(n)||r.replace(/\//g,"_");o=o.replace("​","");const s=[];e.forEach(e=>{let t=B(G(e.text));null!=t&&t.trim()?s.push({id:e.id||"0000000000000",name:e.speaker||"",text:t,trans:""}):e.select&&s.push({id:"select",name:"",text:B(G(e.select)),trans:""})}),s.push({id:"info",name:t,text:"",trans:""}),s.push({id:"译者",name:"",text:"",trans:""}),Wa.name=t,Wa.filename=o+".csv",Wa.list=s})(r,e),ma(Wa)),(()=>{if(Ja)return;Ja=!0;const e=sessionStorage.getItem("sczh:preview");if(e)try{const t=JSON.parse(e),r=new Map(t);for(let[e,t]of r)r.set(e,new Map(t));Wa.preview=r}catch(e){J(e)}})(),t=Wa.preview.has(e)?Wa.preview.get(e):await(async e=>{if(!ls){let e=await en("story.json");if(e)ls=new Map(JSON.parse(e));else{const e=await Vr("/story.json");ls=new Map(e),tn("story.json",JSON.stringify(ls))}}if(ls.has(e)){if(ss.has(e))return ss.get(e);{const t=ls.get(e),r=await Vr(`/data/story/${t}.csv`),n=ds(r);return ss.set(e,n),n}}return!1})(e);const o=await ps();if(t)qa(r,t,o);else if("on"===T.auto){let t=await(async e=>{if(!us){let e=await en("story-ai.json");if(e)us=new Map(JSON.parse(e));else{const e=await Vr(T.ai_host+"/story.json");us=new Map(e),tn("story-ai.json",JSON.stringify(us))}}if(us.has(e)){if(as.has(e))return as.get(e);{const t=us.get(e),r=await Vr(`${T.ai_host}/story/${t}.csv`),n=ds(r,!0);return as.set(e,n),n}}return!1})(e);t?qa(r,t,o):await ei(r,e)}else await ei(r,e,!1,!0);for(let e of r)await Ia(e)}catch(e){J(e)}return r}};let Ka,Va=!1;const Qa=e=>{let t=null;if(!Va){Va=!0,document.body.insertAdjacentHTML("beforeend",'\n  <style>\n  #sczh-aitrans-hint {\n    background-color: #68b631;\n    padding: 8px 12px;\n    color: white;\n    display: block;\n    font-family: HummingStd-E;\n    position: absolute;\n    transform-origin: right bottom;\n    box-shadow: 2px 2px 4px #0000003b;\n    border-radius: 4px;\n    text-shadow: 1px 1px 3px rgb(0 0 0 / 24%);\n  }\n  #sczh-aitrans-hint.hide {\n    display: none !important;\n  }\n  </style>\n  <div id="sczh-aitrans-hint" class="hide">\n  </div>\n  '),t=document.getElementById("sczh-aitrans-hint");const e=pa(()=>{const e=[.2,.22],r=window.innerHeight,n=window.innerWidth;let o=r,s=n,a=0,i=0,c=1;r/n>9/16?(o=9*n/16,a=(r-o)/2,c=s/1600*1.4):(s=16*r/9,i=(n-s)/2,c=o/900*1.4),t.style.right=Math.floor(i+e[0]*s)+"px",t.style.bottom=Math.floor(a+e[1]*o)+"px",t.style.transform=`scale(${c.toFixed(3)})`,Wa.name?t.style.display="flex":t.style.display="none"},300);e(),window.addEventListener("resize",e)}t=document.getElementById("sczh-aitrans-hint"),t.textContent=e,setTimeout(()=>{t.classList.remove("hide")},300),clearTimeout(Ka),Ka=setTimeout(()=>{t.classList.add("hide")},5e3)},Za=async e=>{try{let t=Z("caiyuLimit");if(t&&Date.now()-t<36e5)return[];let[r,n]=(e=>{let t=[],r=e.map(e=>W(e));return r.forEach(e=>{let r=[...e].filter(e=>"\n"===e).length;t.push(r)}),[r.join("\n"),t]})(e),o=((e,t=4e3)=>{let r="",n=[],o=0;return e.split("\n").forEach(e=>{r+=e,o+=new Blob([e]).size,o>t?(n.push(r),o=0,r=""):r+="\n"}),r&&n.push(r.replace(/\n$/,"")),n})(r),s=(await Promise.all(o.map(e=>Ys(e.split("\n"))))).reduce((e,t)=>e.concat(t)),a=[];return((e,t,r)=>{t.forEach(t=>{let n=t,o="";for(;n>=0;){n--;let t=e.shift();"string"==typeof t&&(t||(t="……"),o+=t+"\n")}o&&r.push(o.slice(0,o.length-1))})})(s,n,a),a}catch(e){return"Caiyun api out of limit."===e.message&&Z("caiyuLimit",Date.now()),J(e),[]}},Ya=["text","select","comment","title","actionComment","actionComment2","reactionComment","resultLoseComment","resultStartComment","resultWinComment","characterComment","producerComment","comment1","comment2","mainText","resultText","name"],Xa=new Map,ei=async(e,t,r,n=!1)=>{if(!e.length)return;const o=await ps(),s=await gs(),{textInfo:a,textList:i}=((e,t,r)=>{const n=[],o=[];return e.forEach((e,s)=>{Ya.forEach(a=>{let i=W(e[a]);e[a]&&(t.has(i)?e[a]=t.get(i):r.has(i)?e[a]=r.get(i):(n.push({key:a,index:s}),o.push(i)))})}),{textInfo:n,textList:o}})(e,o,s);if(!a.length)return;const c=t||e;let l=!1,u=[];if(Xa.has(c))l=!0,u=Xa.get(c);else{let e=Gr.data.trans_api,t=[];if("on"===T.auto&&!n){if("caiyun"===e){let e=await(async e=>{const t=await os();return V(e,t)})(i);t=await Za(e)}u=await(async e=>{const t=await ns();return V(e,t)})(t)}Xa.set(c,u)}if(!l&&(T.dev||!t||r)){let e=[];i.forEach((t,r)=>{e.push([G(t),G(u[r])])});let n=J;t&&!r||(n=q);n(e.map(e=>e[1]?(e[1]=e[1],e.join("\n")+"\n"):e[0]).join("\n"))}u.forEach((t,n)=>{let o=t;const{key:s,index:i}=a[n];"select"===s&&(o=((e,t)=>{if(e.length>t&&!e.includes("\n")){const t=Math.floor(e.length/2)+1;return e.slice(0,t)+"\n"+e.slice(t,e.length)}return e})(o,8)),o=o.replace(/"([^"]*)"/g,"“$1”").replace(/'([^']*)'/g,"“$1”").replace(/‘([^']+)'/g,"“$1”"),0!==n||r||Qa("这段剧情由彩云小译机翻"),e[i][s]=o}),(e=>{e.forEach(e=>{e.text&&(e.text="‌"+e.text)})})(e)},ti=async(e,t="comment")=>{if(!e)return;const r=e.map(e=>e[t]).join("").trim();await ei(e,r,!0)},ri=async(e,t="comment")=>{if(!e)return;const r=e.map(e=>e[t]).join("").trim();await ei(e,r,!0,!0)},ni=["actionComment","actionComment2","reactionComment","resultLoseComment","resultStartComment","resultWinComment"],oi=async e=>{try{if(e.produceAudition){let t=e.produceAudition.judges.map(e=>ni.map(t=>e[t]||"").join("")).join("").trim();await ei(e.produceAudition.judges,t,!0)}if(e.produceConcert){let t=e.produceConcert.judges.map(e=>ni.map(t=>e[t]||"").join("")).join("").trim();await ei(e.produceConcert.judges,t,!0)}e.produceConcertFanSkillComments&&await ti(e.produceConcertFanSkillComments,"comment1")}catch(e){J(e)}},si=async e=>{if(e.judges){let t=e.judges.map(e=>ni.map(t=>e[t]||"").join("")).join("").trim();await ei(e.judges,t,!0)}},ai=async e=>{if(e.topCharacterReaction)try{const t=[...e.topCharacterReaction.moveReactions,...e.topCharacterReaction.skillReleasedReactions,...e.topCharacterReaction.touchExReactions,...e.topCharacterReaction.touchReactions,...e.topCharacterReaction.waitReactions];await ti(t)}catch(e){J(e)}},ii=async e=>{let t=[...e.produceStaffComments||[],...e.produceStaffConcertComments||[],...e.produceStaffFailComments||[],...e.produceStaffSeasonComments||[]];await ti(t)},ci=async e=>{if(e.gameData)try{let t=JSON.parse(e.gameData);t.judges?await si(t):await oi(t),e.gameData=JSON.stringify(t)}catch(e){J(e)}},li=async e=>{if(!e.characterComment)return;let t=[];t=t.concat(e.characterComment),await ti(t)},ui=async e=>{if(!e.fesTowerPanelRandom)return;const t=[{name:e.fesTowerPanelRandom.mainText},...e.fesTowerPanelRandom.fesTowerPanelRandomChoices];await ti(t,"name"),e.fesTowerPanelRandom.mainText=t[0].name},di=async e=>{e.fesTowerPanelRandomEffect&&await ti([e.fesTowerPanelRandomEffect],"resultText")};Nr.get([["userProduces",ai],["fes(Match)?Concert/actions/resume",ci]]),Nr.post([["myPage",async e=>{try{let t=[];e.userHomeDeck.userHomeDeckAnimationMember&&(t=[...e.userHomeDeck.userHomeDeckAnimationMember.mypageComments]);let r=e.userHomeDeck.userHomeAnimationDeck.userHomeAnimationDeckMembers;r&&r.forEach(e=>{e.mypageComments.forEach(e=>{t.push(e)}),e.mypageConversations.forEach(e=>{e.mypageConversationComments.forEach(e=>{t.push(e)})})}),e.userHomeDeck.userHomeDeckMembers.length&&e.userHomeDeck.userHomeDeckMembers.forEach(e=>{e.mypageComments.forEach(e=>{t.push(e)})}),await ri(t),await(async(e,t)=>{await Vo(),e.forEach(e=>{Xo(e,t)})})(t,"speakerName")}catch(e){J(e)}}],["fesTop",async e=>{if(e.userFesDeck)try{let t=[],r=e.userFesDeck.userFesDeckMembers;for(let e of r)e.fesTopCharacterReactions.forEach(e=>{t.push(e)});await ti(t)}catch(e){J(e)}}],["produces/actions/(resume|next)",[ai,ii,ci,li,oi,async e=>{try{var t;await ti(null===(t=e.produceReporterEvent)||void 0===t?void 0:t.produceReporterEventAnswers,"comment2")}catch(e){J(e)}}]],["produces/actions/endWeek",ii],["produces/actions/act",async e=>{if(!e.lessonResult)return;let t=e.lessonResult;try{let e=[];t.produceActCutinComment&&(e=e.concat(t.produceActCutinComment)),t.produceRestBoostIdolComment&&(e=e.concat(t.produceRestBoostIdolComment)),t.produceRestBoostSupportIdolComment&&(e=e.concat(t.produceRestBoostSupportIdolComment)),t.produceRestComments&&(e=e.concat(t.produceRestComments)),await ti(e)}catch(e){J(e)}}],["fes(Match|Raid)?Concert/actions/start",si],["fes(Match)?Concert/actions/resume",ci],["fesRaidConcert/actions/resume",async e=>{if(e.gameState&&e.gameState.game_data)try{let t=JSON.parse(e.gameState.game_data);t.judges&&await si(t),e.gameState.game_data=JSON.stringify(t)}catch(e){J(e)}}],["produces/actions/result",async e=>{try{let t=e.characterTrustLevelUpComments;await ti(t)}catch(e){J(e)}}],["produces/({num}/audition|concert)/actions/(start|finish)",[oi,li]],["userProduceHelperSupportIdols",async e=>{try{let t=e.characterComment+e.producerComment;await ei([e],t,!0)}catch(e){J(e)}}],["userFesTowerPanels/{num}/random",ui],["userFesTowerPanels/{num}/random/actions/choice",di],["userFesTowerAreas/{num}",async e=>{for(let r of e.userFesTowerStages){var t;const e=null===(t=r.userFesTowerPanelHistory)||void 0===t?void 0:t.userFesTowerRandomPanelHistory;e&&(await ui(e),await di(e))}}],["fesTowerEvents/top",async e=>{var t;const r=null===(t=e.userFesTowerEventTopIdols)||void 0===t?void 0:t.map(e=>e.fesTowerEventTopCharacterReaction);await ti(r)}]]);Nr.get("gashas/{num}/redraws",async e=>{const t=[];e.forEach(e=>{e.comment&&t.push(e.comment)}),await ri(t)}),Nr.post([["characterAlbums/characters/{num}",async e=>{const t=[];e.produceIdols.forEach(e=>{e.comment&&t.push(e.comment)}),await ri(t)}],["gashas/{num}/actions/draw",async e=>{var t;const r=[];null===(t=e.gashaDraws)||void 0===t||t.forEach(e=>{e.comment&&r.push(e.comment)}),await ri(r)}]]);Nr.post("characterAlbums/characters/{num}",async e=>{if(e.voices){const t=[];e.voices.forEach(e=>{e.characterTrustLevelComment&&t.push(e.characterTrustLevelComment)}),await ri(t)}});const pi=new Map;let fi=!1;const hi=["nameKana","unit","age","bloodType","birthday","starSign","height","weight","figure","arm","place","hobby","specialty","cv"],mi=async()=>{if(!fi){(await nn("profile")).forEach(e=>{if(null!=e&&e.id){const t=U(e.id);if(t)if("label"===t){const r=U(e.nameKana).split("|");pi.set(t,new Map(hi.map((e,t)=>[e,B(r[t])])))}else{for(let t in e)e[t]=U(e[t]);pi.set(t,e)}}}),fi=!0}return pi},gi=async e=>{const t=await mi();await(async e=>{const t=await un();t.has(e.name)&&(e.name=t.get(e.name)),t.has(e.firstName)&&(e.firstName=t.get(e.firstName))})(e);const r=t.get(e.id);for(let t in r)"id"!==t&&e[t]&&("unit"===t?e.unit.name=r[t]:e[t]=r[t])};Nr.post("characterAlbums/characters/{num}",async e=>{await gi(e)}),Nr.get("userIdols/{num}",async e=>{const t=e.idol.character;await gi(t)}),Nr.get("userSupportIdols/{num}",async e=>{const t=e.supportIdol.character;await gi(t)}),Nr.get("userFesIdols/{num}",async e=>{const t=e.userFesIdol.idol.character;await gi(t)});const vi=new Map;let yi=!1;let wi=null;async function bi(){const e=await Oa("PHRASE");if(e){wi=await(async(e=!1)=>{if(!yi){(await nn("phrase")).forEach(t=>{if(null!=t&&t.id){const r=U(t.id),n=U(t.trans,!0);r&&(e?vi.set(r,t.trans):n&&vi.set(r,n))}}),yi=!0}return vi})();for(let[t,r]of wi)e[t]=r}}let Ei=!1,ki=null;const _i=on({name:"common"});let Si=new Map,xi=new Map;const Ii=[],Ai=(e,t)=>{let r=e,n=W(e);return t.has(n)&&(r=t.get(n)),r},Ci=(e,t=!1)=>{if("string"!=typeof e)return e;let r=e;return e.trim()&&(t?(r=Ai(e,xi),r===e&&(e=>{Ii.push(e),T.dev,setTimeout(()=>Ii.shift(),1e4)})(e)):(e=>{let t=!1;return Ii.forEach(r=>{r.startsWith(e)&&(t=!0)}),t})(e)||e.startsWith("‌")||(r=Ai(e,Si))),r};async function ji(){const e=await Oa("AOBA");try{Si=await(async()=>{if(!Ei){ki=await _i();const e=await un();ki=new Map([...e,...ki]),Ei=!0}return ki})(),xi=await gs()}catch(e){}const t=e.Text.prototype.typeText;e.Text.prototype.typeText=function(...e){const r=e[0];return e[0]=Ci(r,!0),t.apply(this,e)};const r=e.Text.prototype.updateText;e.Text.prototype.updateText=function(e){if(this.localStyleID!==this._style.styleID&&(this.dirty=!0,this._style.styleID),this.dirty||!e){T.dev,0;const t=Ci(this._text);return Reflect.set(this,"_text",t),r.call(this,e)}}}const Mi=new Map;let Ti=!1;let Ri=null;const Pi=async()=>{if(!Ri){let e=await en("picture.json");if(e)Ri=new Map(JSON.parse(e));else{const e=await Vr("/picture.json");Ri=new Map(e),tn("picture.json",JSON.stringify(Ri))}}return Ri};let Oi=null;let Di=null;const Fi=()=>Di||(Di=(async()=>{if(Oi)return Oi;try{const e=await fetch("https://comic.shiny.fun/4ko.json?t="+Math.floor(Date.now()/36e5)),t=await e.json();Oi=new Map(t)}catch(e){Oi=new Map}return Oi})(),Di);Nr.get([[["comics"],async e=>{await Fi(),e.comics.forEach(e=>{const t=parseInt(e.id);if(Oi.has(t)){const r=Oi.get(t).title;r&&(e.title=r)}})}]]);let zi=null;const Li=async()=>(zi||(zi=(async()=>{if(!Ti){(await nn("image")).forEach(e=>{if(null!=e&&e.name){const t=B(e.name),r=B(e.url),n=B(e.version)||"1";t&&r&&Mi.set(t,{url:r,version:n})}}),Ti=!0}return Mi})()),await zi);let $i="";(()=>{try{$i=sessionStorage.getItem("sczh:res-name")}catch(e){}})();(window.unsafeWindow||window).queryImageName=e=>{try{sessionStorage.setItem("sczh:res-name",e)}catch(e){}};let Ni=!1;async function Bi(){const e=await Oa("AOBA"),{isSupportedWebP:t,toWebPUrl:r}=await Oa("WEBP"),n=await Pi();if(Ni)return;e.loaders.Resource.prototype=Object.assign({},e.loaders.Resource.prototype);const o=e.loaders.Resource.prototype._loadElement;e.loaders.Resource.prototype._loadElement=async function(e){T.dev&&"image"===e&&$i&&this.url.includes($i)&&(q("%c查询到的图片：","color:#66ccff"),q(this.url,this.name));try{const o=await Li();if("image"===e){var s;if(o.has(this.name)){const e=o.get(this.name);if(this.url.endsWith("v="+e.version)){const n="image/"+e.url;let o=n;t()&&!o.startsWith("tips/")&&(o=r(o)),this.url=`${T.origin}/data/${o}?v=${T.hashes[n]}`,this.crossOrigin=!0}else J(this.name,this.url)}else n.has(null===(s=this.name)||void 0===s?void 0:s.replace("images/",""))&&(this.url=`${T.origin}/data/${this.name.replace("images/","picture/")}?v=${n.get(this.name.replace("images/",""))}`,this.crossOrigin=!0);await async function(e){if(/^images\/content\/comics\/(web|limited|special)\/page\/[^_]+_\d+\.jpg/.test(e.name)){const t=parseInt(e.name.match(/page\/[^_]+_(\d+)\.jpg/)[1]);await Fi(),Oi.has(t)&&(e.url="https://comic.shiny.fun/4ko/"+Oi.get(t).name,e.crossOrigin=!0)}}(this)}}catch(e){J(e)}return o.call(this,e)},Ni=!0}const Ui=e=>{const t=document.createElement("link");t.setAttribute("rel","preload"),t.setAttribute("href",e),t.setAttribute("as","font"),t.setAttribute("type","font/woff2"),t.setAttribute("crossorigin","anonymous"),document.head.appendChild(t)},Hi=(e,t)=>`/data/font/${e}.woff2?v=${t[`font/${e}.woff2`]}`,Wi=async()=>{const e=document.createElement("style"),{hashes:t}=await Kr;e.innerHTML=`\n  @font-face {\n    font-family: "UDKakugo_SmallPr6-B";\n    src: url("${T.origin}${Hi("heiti",t)}"),\n      url("/assets/fonts/primula-UDKakugo_SmallPr6-B.woff2?v=5b98f6814db5b7ff2e73b0bbbd48ebb3");\n  }\n  @font-face {\n    font-family: "HummingStd-E";\n    src: url("${T.origin}${Hi("yuanti",t)}"),\n      url("/assets/fonts/primula-HummingStd-E.woff2?v=57f0e9684ac32d5ed54c567c001eaaaa");\n  }\n  ::-webkit-scrollbar {\n    display: none;\n  }\n  `,"yuanti"===T.font1&&Ui(`${T.origin}${Hi("yuanti",t)}`),"heiti"===T.font2&&Ui(`${T.origin}${Hi("heiti",t)}`),document.body.appendChild(e)};window.addEventListener("blur",(function(e){"on"===T.bgm&&e.stopImmediatePropagation()}),!1),document.addEventListener("visibilitychange",(function(e){"on"===T.bgm&&e.stopImmediatePropagation()}));let Ji=0;const qi=async()=>{var e;Aa||Ji>=300?(async()=>{try{await Promise.all([Bi(),Wi(),bi(),ji(),Ga()])}catch(e){J(e)}})():(await(e=100,new Promise(t=>{setTimeout(t,e)})),Ji++,Ji%10==0&&J(`Waiting: ${Ji/10}s`),await qi())};let Gi=window.unsafeWindow||window;"loading"!=Gi.document.readyState?qi():Gi.addEventListener("DOMContentLoaded",qi)}();
